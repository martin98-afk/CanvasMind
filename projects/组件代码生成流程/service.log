INFO:     Started server process [3600]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
[32m2025-10-09 12:04:48.116[0m | [1mINFO    [0m | [36mrunner.workflow_runner[0m:[36mexecute_workflow[0m:[36m139[0m - [1mæ‰§è¡ŒèŠ‚ç‚¹: é•¿æ–‡æœ¬è¾“å…¥ 1[0m
[32m2025-10-09 12:04:54.495[0m | [33m[1mWARNING [0m | [36mrunner.component_executor[0m:[36m_run_subprocess[0m:[36m173[0m - [33m[1må­è¿›ç¨‹ stderr:
[32m2025-10-09 12:04:54.150[0m | [32m[1mSUCCESS [0m | [36m__main__[0m:[36msuccess[0m:[36m27[0m - [32m[1mæ‰§è¡Œå®Œæˆ[0m
[0m
[32m2025-10-09 12:04:54.523[0m | [1mINFO    [0m | [36mrunner.workflow_runner[0m:[36mexecute_workflow[0m:[36m139[0m - [1mæ‰§è¡ŒèŠ‚ç‚¹: JSONæ–‡æœ¬åŒ…è£…[0m
[32m2025-10-09 12:04:59.586[0m | [33m[1mWARNING [0m | [36mrunner.component_executor[0m:[36m_run_subprocess[0m:[36m173[0m - [33m[1må­è¿›ç¨‹ stderr:
[32m2025-10-09 12:04:59.418[0m | [32m[1mSUCCESS [0m | [36m__main__[0m:[36msuccess[0m:[36m27[0m - [32m[1mæ‰§è¡Œå®Œæˆ[0m
[0m
[32m2025-10-09 12:04:59.610[0m | [1mINFO    [0m | [36mrunner.workflow_runner[0m:[36mexecute_workflow[0m:[36m139[0m - [1mæ‰§è¡ŒèŠ‚ç‚¹: æç¤ºè¯æ¨¡æ¿ 3[0m
[32m2025-10-09 12:05:02.941[0m | [33m[1mWARNING [0m | [36mrunner.component_executor[0m:[36m_run_subprocess[0m:[36m173[0m - [33m[1må­è¿›ç¨‹ stderr:
[32m2025-10-09 12:05:02.801[0m | [1mINFO    [0m | [36m__main__[0m:[36minfo[0m:[36m26[0m - [1m{'variables': {'text': 'æˆ‘ç°åœ¨è¦æä¸€ä¸ªæ•°æ®å½’ä¸€åŒ–ç»„ä»¶'}}[0m
[32m2025-10-09 12:05:02.802[0m | [1mINFO    [0m | [36m__main__[0m:[36minfo[0m:[36m26[0m - [1m##  ä»»åŠ¡
æ ¹æ®æˆ‘çš„ç»„ä»¶è¾“å…¥ã€è¾“å‡ºã€èŠ‚ç‚¹å‚æ•°å®šä¹‰ä»¥åŠæˆ‘çš„æ ·ä¾‹ä»£ç ã€éœ€æ±‚ç­‰ä¿¡æ¯è‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„pythonç»„ä»¶ä»£ç 

## ç»„ä»¶è¾“å…¥è¾“å‡ºå‚æ•°å®šä¹‰ä»£ç 
class ArgumentType(str, Enum):
    """å‚æ•°ç±»å‹"""
    TEXT = "æ–‡æœ¬"
    INT = "æ•´æ•°"
    FLOAT = "æµ®ç‚¹æ•°"
    BOOL = "å¸ƒå°”å€¼"
    ARRAY = "åˆ—è¡¨"
    CSV = "csv"
    JSON = "json"
    EXCEL = "excel"
    FILE = "æ–‡ä»¶"
    UPLOAD = "ä¸Šä¼ "
    SKLEARNMODEL = "sklearnæ¨¡å‹"
    TORCHMODEL = "torchæ¨¡å‹"
    IMAGE = "å›¾ç‰‡"

class PortDefinition(BaseModel):
    """ç«¯å£å®šä¹‰"""
    name: str
    label: str
    type: ArgumentType = ArgumentType.TEXT

## ç»„ä»¶å±æ€§å‚æ•°å®šä¹‰ä»£ç 
class PropertyType(str, Enum):
    """å±æ€§ç±»å‹"""
    TEXT = "æ–‡æœ¬"
    LONGTEXT = "é•¿æ–‡æœ¬"
    INT = "æ•´æ•°"
    FLOAT = "æµ®ç‚¹æ•°"
    RANGE = "èŒƒå›´"
    BOOL = "å¤é€‰æ¡†"
    CHOICE = "ä¸‹æ‹‰æ¡†"
    DYNAMICFORM = "åŠ¨æ€è¡¨å•"


class PropertyDefinition(BaseModel):
    """å±æ€§å®šä¹‰"""
    type: PropertyType = PropertyType.TEXT
    default: Any = ""
    label: str = ""
    choices: List[str] = Field(default_factory=list)
    filter: str = "All Files (*)"  # ç”¨äºæ–‡ä»¶ç±»å‹è¿‡æ»¤
    schema: Optional[Dict[str, 'PropertyDefinition']] = Field(default=None)  # è¡¨å•å†…æ¯ä¸ªå­—æ®µçš„å®šä¹‰
    min: float = Field(default=0.0, description="æœ€å°å€¼")
    max: float = Field(default=100.0, description="æœ€å¤§å€¼")
    step: float = Field(default=1.0, description="æ­¥é•¿")

    class Config:
        # å…è®¸é€’å½’å¼•ç”¨
        arbitrary_types_allowed = True

## æˆ‘çš„ç»„ä»¶æ ·ä¾‹ä»£ç 
class Component(BaseComponent):
    name = "æç¤ºè¯æ¨¡æ¿"
    category = "å¤§æ¨¡å‹ç»„ä»¶"
    description = ""
    requirements = ""

    inputs = [
        PortDefinition(name="variables", label="å˜é‡å­—å…¸", type=ArgumentType.JSON),
    ]
    outputs = [
        PortDefinition(name="prompt", label="ç”Ÿæˆçš„æç¤ºè¯", type=ArgumentType.TEXT),
    ]

    properties = {
        "template": PropertyDefinition(
            type=PropertyType.LONGTEXT,
            default="""ä½ å¥½ï¼Œ{{name}}ï¼ä»Šå¤©æ˜¯{{day}}ã€‚""",
            label="æç¤ºè¯æ¨¡æ¿",
        ),
    }

    def run(self, params, inputs = None):
        import re
        self.logger.info(inputs)
        template = params.get("template", "")
        variables = inputs.get("variables", {}) if inputs else {}

        if isinstance(variables, str):
            import json
            try:
                variables = json.loads(variables)
            except:
                variables = {}

        # æ›¿æ¢ {{key}} ä¸ºå˜é‡å€¼
        def replace_match(match):
            key = match.group(1)
            return str(variables.get(key, match.group(0)))

        prompt = re.sub(r"\{\{(\w+)\}\}", replace_match, template)
        self.logger.info(prompt)
        
        return {"prompt": prompt}

## æˆ‘çš„ç»„ä»¶å¼€å‘éœ€æ±‚
æˆ‘ç°åœ¨è¦æä¸€ä¸ªæ•°æ®å½’ä¸€åŒ–ç»„ä»¶

## ä»£ç è¾“å‡ºè¦æ±‚
è¾“å‡ºä»£ç ä¸éœ€è¦åŒ…å«è¾“å…¥ã€è¾“å‡ºä»¥åŠå±æ€§å‚æ•°å®šä¹‰ä»£ç ï¼Œè¿™éƒ¨åˆ†å·²ç»å†™å¥½äº†ï¼ŒåŒæ—¶ç¬¬ä¸‰æ–¹å·¥å…·åŒ…å¯¼å…¥æ—¶åªèƒ½åœ¨å‡½æ•°å†…å¯¼å…¥ï¼Œä¸èƒ½åœ¨æ–‡ä»¶å¼€å¤´å¯¼å…¥ï¼Œä¸è¦å¼•å…¥Dictï¼ŒListè¿™äº›å‚æ•°æ ¼å¼å®šä¹‰ã€‚

## ç”Ÿæˆçš„ç»„ä»¶ä»£ç 
[0m
[32m2025-10-09 12:05:02.802[0m | [32m[1mSUCCESS [0m | [36m__main__[0m:[36msuccess[0m:[36m27[0m - [32m[1mæ‰§è¡Œå®Œæˆ[0m
[0m
[32m2025-10-09 12:05:02.957[0m | [1mINFO    [0m | [36mrunner.workflow_runner[0m:[36mexecute_workflow[0m:[36m139[0m - [1mæ‰§è¡ŒèŠ‚ç‚¹: å¤§æ¨¡å‹å¯¹è¯ 3[0m
[32m2025-10-09 12:05:22.393[0m | [33m[1mWARNING [0m | [36mrunner.component_executor[0m:[36m_run_subprocess[0m:[36m173[0m - [33m[1må­è¿›ç¨‹ stderr:
[32m2025-10-09 12:05:22.014[0m | [1mINFO    [0m | [36m__main__[0m:[36minfo[0m:[36m26[0m - [1mChatCompletion(id='chatcmpl-58ca6ed64ce7456997209480f5473f71', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='<think>\nå¥½çš„ï¼Œæˆ‘ç°åœ¨éœ€è¦æ ¹æ®ç”¨æˆ·æä¾›çš„ç»„ä»¶è¾“å…¥è¾“å‡ºå‚æ•°å®šä¹‰ã€å±æ€§å‚æ•°å®šä¹‰ä»¥åŠæ ·ä¾‹ä»£ç ï¼Œç”Ÿæˆä¸€ä¸ªæ•°æ®å½’ä¸€åŒ–ç»„ä»¶çš„Pythonä»£ç ã€‚é¦–å…ˆï¼Œæˆ‘éœ€è¦ç†è§£ç”¨æˆ·çš„éœ€æ±‚ã€‚ç”¨æˆ·æåˆ°è¦åˆ›å»ºä¸€ä¸ªæ•°æ®å½’ä¸€åŒ–ç»„ä»¶ï¼Œè¿™é€šå¸¸æ¶‰åŠå°†æ•°æ®ç¼©æ”¾åˆ°0-1çš„èŒƒå›´æˆ–è€…å…¶ä»–çš„å½’ä¸€åŒ–æ–¹æ³•ã€‚\n\né¦–å…ˆï¼Œæˆ‘éœ€è¦æŸ¥çœ‹ç”¨æˆ·æä¾›çš„æ ·ä¾‹ä»£ç ï¼Œäº†è§£å…¶ç»“æ„ã€‚æ ·ä¾‹ä¸­çš„Componentç±»æœ‰inputsã€outputsã€propertiesï¼Œä»¥åŠrunæ–¹æ³•ã€‚è¾“å…¥å¯èƒ½æ˜¯ä¸€ä¸ªå˜é‡å­—å…¸ï¼Œè¾“å‡ºæ˜¯ç”Ÿæˆçš„æç¤ºè¯ã€‚å±æ€§ä¸­æœ‰templateï¼Œç”¨äºæ¨¡æ¿æ›¿æ¢ã€‚\n\nç°åœ¨ï¼Œç”¨æˆ·éœ€è¦çš„æ˜¯æ•°æ®å½’ä¸€åŒ–ç»„ä»¶ï¼Œæ‰€ä»¥è¾“å…¥å¯èƒ½éœ€è¦ä¸€ä¸ªæ•°æ®åˆ—æˆ–çŸ©é˜µï¼Œè¾“å‡ºæ˜¯å½’ä¸€åŒ–åçš„æ•°æ®ã€‚å±æ€§å¯èƒ½éœ€è¦é€‰æ‹©å½’ä¸€åŒ–æ–¹æ³•ï¼ˆå¦‚Min-Maxã€Z-Scoreï¼‰ï¼Œå¯èƒ½è¿˜æœ‰æ˜¯å¦å¤„ç†ç¼ºå¤±å€¼ç­‰å‚æ•°ã€‚\n\næ¥ä¸‹æ¥ï¼Œæ ¹æ®ç”¨æˆ·çš„è¦æ±‚ï¼Œä»£ç ä¸éœ€è¦åŒ…å«è¾“å…¥è¾“å‡ºå‚æ•°å®šä¹‰ï¼Œè¿™äº›å·²ç»å­˜åœ¨ã€‚ç¬¬ä¸‰æ–¹åº“åªèƒ½åœ¨å‡½æ•°å†…éƒ¨å¯¼å…¥ï¼Œä¸èƒ½åœ¨æ–‡ä»¶å¼€å¤´ã€‚åŒæ—¶ï¼Œä¸èƒ½ä½¿ç”¨Dictã€Listè¿™äº›ç±»å‹æ³¨è§£ï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦ä½¿ç”¨æ™®é€šçš„å­—å…¸å’Œåˆ—è¡¨ã€‚\n\né¦–å…ˆï¼Œå®šä¹‰ç»„ä»¶çš„inputså’Œoutputsã€‚è¾“å…¥å¯èƒ½æ˜¯ä¸€ä¸ªæ•°æ®åˆ—ï¼Œç±»å‹å¯èƒ½æ˜¯ARRAYæˆ–CSVï¼Œè¾“å‡ºæ˜¯å½’ä¸€åŒ–åçš„æ•°æ®ï¼Œç±»å‹å¯èƒ½æ˜¯ARRAYã€‚ä¾‹å¦‚ï¼š\n\ninputs = [\n    PortDefinition(name="data", label="è¾“å…¥æ•°æ®", type=ArgumentType.ARRAY),\n]\noutputs = [\n    PortDefinition(name="normalized_data", label="å½’ä¸€åŒ–åçš„æ•°æ®", type=ArgumentType.ARRAY),\n]\n\nç„¶åï¼Œå±æ€§éƒ¨åˆ†éœ€è¦å®šä¹‰å½’ä¸€åŒ–æ–¹æ³•ï¼Œå¯èƒ½è¿˜æœ‰æ˜¯å¦ä½¿ç”¨z-scoreç­‰ã€‚ä¾‹å¦‚ï¼Œå±æ€§å¯èƒ½åŒ…æ‹¬methodï¼ˆä¸‹æ‹‰æ¡†ï¼Œé€‰é¡¹ä¸ºMin-Maxã€Z-Scoreï¼‰ï¼Œå¯èƒ½è¿˜æœ‰å…¶ä»–å‚æ•°å¦‚å¤„ç†ç¼ºå¤±å€¼çš„é€‰é¡¹ã€‚\n\nå±æ€§å®šä¹‰å¯èƒ½åƒï¼š\n\nproperties = {\n    "method": PropertyDefinition(\n        type=PropertyType.CHOICE,\n        default="minmax",\n        label="å½’ä¸€åŒ–æ–¹æ³•",\n        choices=["minmax", "zscore"],\n    ),\n    "handle_missing": PropertyDefinition(\n        type=PropertyType.CHOICE,\n        default="none",\n        label="å¤„ç†ç¼ºå¤±å€¼",\n        choices=["none", "mean", "median", "constant"],\n    ),\n    "constant_value": PropertyDefinition(\n        type=PropertyType.FLOAT,\n        default=0.0,\n        label="å¸¸é‡å€¼",\n        min=0.0,\n        max=100.0,\n        step=0.1,\n    ),\n}\n\nä¸è¿‡ï¼Œç”¨æˆ·å¯èƒ½å¸Œæœ›æ›´å…·ä½“çš„å‚æ•°ï¼Œæ¯”å¦‚æ˜¯å¦åº”ç”¨åˆ°æ‰€æœ‰ç‰¹å¾ï¼Œæˆ–è€…æ˜¯å¦æœ‰å…¶ä»–é€‰é¡¹ã€‚éœ€è¦æ ¹æ®å¸¸è§çš„å½’ä¸€åŒ–ç»„ä»¶æ¥è®¾è®¡å±æ€§ã€‚\n\næ¥ä¸‹æ¥ï¼Œrunæ–¹æ³•éœ€è¦å®ç°å½’ä¸€åŒ–é€»è¾‘ã€‚åœ¨å‡½æ•°å†…éƒ¨ï¼Œå¯èƒ½éœ€è¦å¯¼å…¥å¿…è¦çš„åº“ï¼Œå¦‚numpyæˆ–sklearnã€‚ä¾‹å¦‚ï¼Œå¯¹äºMin-Maxå½’ä¸€åŒ–ï¼Œå¯ä»¥ä½¿ç”¨ sklearn.preprocessing.MinMaxScalerï¼Œè€ŒZ-Scoreåˆ™ä½¿ç”¨StandardScalerã€‚ä½†ç”¨æˆ·è¦æ±‚åªèƒ½åœ¨å‡½æ•°å†…éƒ¨å¯¼å…¥ï¼Œæ‰€ä»¥éœ€è¦åœ¨runæ–¹æ³•ä¸­åŠ¨æ€å¯¼å…¥ã€‚\n\nå¤„ç†è¾“å…¥æ•°æ®æ—¶ï¼Œéœ€è¦å°†è¾“å…¥çš„æ•°æ®è½¬æ¢ä¸ºæ•°ç»„ï¼Œå¤„ç†ç¼ºå¤±å€¼ï¼Œç„¶ååº”ç”¨å½’ä¸€åŒ–æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š\n\ndef run(self, params, inputs=None):\n    import numpy as np\n    from sklearn.preprocessing import MinMaxScaler, StandardScaler\n\n    data = inputs.get("data", [])\n    method = params.get("method", "minmax")\n    handle_missing = params.get("handle_missing", "none")\n    constant_value = params.get("constant_value", 0.0)\n\n    # å¤„ç†ç¼ºå¤±å€¼\n    if handle_missing == "mean":\n        # è®¡ç®—å‡å€¼ï¼Œå¡«å……ç¼ºå¤±å€¼\n        data = np.array(data)\n        # è¿™é‡Œå¯èƒ½éœ€è¦æ›´å¤æ‚çš„å¤„ç†ï¼Œæ¯”å¦‚é€åˆ—è®¡ç®—å‡å€¼\n        # ç¤ºä¾‹ï¼šå‡è®¾dataæ˜¯äºŒç»´æ•°ç»„ï¼Œè®¡ç®—æ¯åˆ—çš„å‡å€¼\n        # è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…å¯èƒ½éœ€è¦æ›´å¤æ‚çš„é€»è¾‘\n        pass\n    # å…¶ä»–å¤„ç†ç¼ºå¤±å€¼çš„é€»è¾‘...\n\n    # åº”ç”¨å½’ä¸€åŒ–æ–¹æ³•\n    if method == "minmax":\n        scaler = MinMaxScaler()\n        normalized_data = scaler.fit_transform(data)\n    elif method == "zscore":\n        scaler = StandardScaler()\n        normalized_data = scaler.fit_transform(data)\n    else:\n        normalized_data = data\n\n    return {"normalized_data": normalized_data.tolist()}\n\nä¸è¿‡ï¼Œéœ€è¦è€ƒè™‘è¾“å…¥æ•°æ®çš„ç»“æ„ã€‚æ¯”å¦‚ï¼Œå¦‚æœè¾“å…¥æ˜¯äºŒç»´æ•°ç»„ï¼Œå¯èƒ½éœ€è¦å¤„ç†æ¯ä¸ªç‰¹å¾ã€‚å¦å¤–ï¼Œå¤„ç†ç¼ºå¤±å€¼çš„éƒ¨åˆ†éœ€è¦æ›´è¯¦ç»†çš„å®ç°ï¼Œæ¯”å¦‚ä½¿ç”¨numpyçš„nanå¤„ç†å‡½æ•°ã€‚\n\nå¦å¤–ï¼Œç”¨æˆ·å¯èƒ½å¸Œæœ›å±æ€§ä¸­çš„æŸäº›å‚æ•°æ ¹æ®é€‰æ‹©æ˜¾ç¤ºæˆ–éšè—ï¼Œæ¯”å¦‚å½“handle_missingè®¾ç½®ä¸ºconstantæ—¶ï¼Œæ˜¾ç¤ºconstant_valueå‚æ•°ã€‚ä½†æ ¹æ®ç”¨æˆ·æä¾›çš„PropertyDefinitionï¼Œå¯èƒ½æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦åœ¨å±æ€§ä¸­è®¾ç½®æ¡ä»¶ï¼Œä½†ç”¨æˆ·æä¾›çš„ä»£ç ä¸­æ²¡æœ‰æåˆ°ï¼Œå¯èƒ½ä¸éœ€è¦å¤„ç†ã€‚\n\næœ€åï¼Œç¡®ä¿ç»„ä»¶çš„nameã€categoryã€descriptionç­‰å±æ€§æ­£ç¡®ã€‚ä¾‹å¦‚ï¼š\n\nclass Component(BaseComponent):\n    name = "æ•°æ®å½’ä¸€åŒ–"\n    category = "æ•°æ®é¢„å¤„ç†ç»„ä»¶"\n    description = "å¯¹è¾“å…¥æ•°æ®è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼Œæ”¯æŒMin-Maxå’ŒZ-Scoreæ–¹æ³•ã€‚"\n\n    inputs = [...] \n    outputs = [...]\n    properties = {...}\n\néœ€è¦æ£€æŸ¥æ˜¯å¦ç¬¦åˆç”¨æˆ·æä¾›çš„æ ·ä¾‹ç»“æ„ï¼Œæ¯”å¦‚å±æ€§æ˜¯å¦ä½¿ç”¨æ­£ç¡®çš„ç±»å‹å’Œé»˜è®¤å€¼ã€‚\n\nå¯èƒ½è¿˜éœ€è¦å¤„ç†è¾“å…¥æ•°æ®çš„ç±»å‹è½¬æ¢ï¼Œæ¯”å¦‚å°†è¾“å…¥çš„åˆ—è¡¨è½¬æ¢ä¸ºnumpyæ•°ç»„ï¼Œæˆ–è€…å¤„ç†å¯èƒ½çš„å¼‚å¸¸æƒ…å†µã€‚\n\nç»¼ä¸Šï¼Œç”Ÿæˆçš„ä»£ç åº”è¯¥åŒ…æ‹¬æ­£ç¡®çš„è¾“å…¥è¾“å‡ºç«¯å£å®šä¹‰ï¼Œå±æ€§å®šä¹‰ï¼Œä»¥åŠå®ç°å½’ä¸€åŒ–é€»è¾‘çš„runæ–¹æ³•ï¼Œå…¶ä¸­å¯¼å…¥å¿…è¦çš„åº“åœ¨å‡½æ•°å†…éƒ¨ï¼Œå¹¶å¤„ç†å„ç§å‚æ•°ã€‚\n</think>\n\n```python\nclass Component(BaseComponent):\n    name = "æ•°æ®å½’ä¸€åŒ–"\n    category = "æ•°æ®é¢„å¤„ç†ç»„ä»¶"\n    description = "å¯¹è¾“å…¥æ•°æ®è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼Œæ”¯æŒMin-Maxå’ŒZ-Scoreæ–¹æ³•ã€‚"\n\n    inputs = [\n        PortDefinition(name="data", label="è¾“å…¥æ•°æ®", type=ArgumentType.ARRAY),\n    ]\n    outputs = [\n        PortDefinition(name="normalized_data", label="å½’ä¸€åŒ–åçš„æ•°æ®", type=ArgumentType.ARRAY),\n    ]\n\n    properties = {\n        "method": PropertyDefinition(\n            type=PropertyType.CHOICE,\n            default="minmax",\n            label="å½’ä¸€åŒ–æ–¹æ³•",\n            choices=["minmax", "zscore"],\n        ),\n        "handle_missing": PropertyDefinition(\n            type=PropertyType.CHOICE,\n            default="none",\n            label="å¤„ç†ç¼ºå¤±å€¼",\n            choices=["none", "mean", "median", "constant"],\n        ),\n        "constant_value": PropertyDefinition(\n            type=PropertyType.FLOAT,\n            default=0.0,\n            label="å¸¸é‡å€¼",\n            min=0.0,\n            max=100.0,\n            step=0.1,\n        ),\n    }\n\n    def run(self, params, inputs=None):\n        import numpy as np\n        from sklearn.preprocessing import MinMaxScaler, StandardScaler\n        \n        data = np.array(inputs.get("data", []))\n        method = params.get("method", "minmax")\n        handle_missing = params.get("handle_missing", "none")\n        constant_value = params.get("constant_value", 0.0)\n        \n        # å¤„ç†ç¼ºå¤±å€¼\n        if handle_missing == "mean":\n            data = np.nan_to_num(data, nan=np.nanmean(data))\n        elif handle_missing == "median":\n            data = np.nan_to_num(data, nan=np.nanmedian(data))\n        elif handle_missing == "constant":\n            data = np.nan_to_num(data, nan=constant_value)\n        \n        # æ‰§è¡Œå½’ä¸€åŒ–\n        if method == "minmax":\n            scaler = MinMaxScaler()\n            normalized_data = scaler.fit_transform(data)\n        elif method == "zscore":\n            scaler = StandardScaler()\n            normalized_data = scaler.fit_transform(data)\n        else:\n            normalized_data = data\n        \n        return {"normalized_data": normalized_data.tolist()}\n```', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=[], reasoning_content=None), stop_reason=None, token_ids=None)], created=1759982759, model='qwen3-30b-a3b', object='chat.completion', service_tier=None, system_fingerprint=None, usage=CompletionUsage(completion_tokens=1657, prompt_tokens=807, total_tokens=2464, completion_tokens_details=None, prompt_tokens_details=None), prompt_logprobs=None, prompt_token_ids=None, kv_transfer_params=None)[0m
[32m2025-10-09 12:05:22.015[0m | [1mINFO    [0m | [36m__main__[0m:[36minfo[0m:[36m26[0m - [1mæ¨¡å‹å›å¤: <think>
å¥½çš„ï¼Œæˆ‘ç°åœ¨éœ€è¦æ ¹æ®ç”¨æˆ·æä¾›çš„ç»„ä»¶è¾“å…¥è¾“å‡ºå‚æ•°å®šä¹‰ã€å±æ€§å‚æ•°å®šä¹‰ä»¥åŠæ ·ä¾‹ä»£ç ï¼Œç”Ÿæˆä¸€ä¸ªæ•°æ®å½’ä¸€åŒ–ç»„ä»¶çš„Pythonä»£ç ã€‚é¦–å…ˆï¼Œæˆ‘éœ€è¦ç†è§£ç”¨æˆ·çš„éœ€æ±‚ã€‚ç”¨æˆ·æåˆ°è¦åˆ›å»ºä¸€ä¸ªæ•°æ®å½’ä¸€åŒ–ç»„ä»¶ï¼Œè¿™...[0m
[32m2025-10-09 12:05:22.016[0m | [32m[1mSUCCESS [0m | [36m__main__[0m:[36msuccess[0m:[36m27[0m - [32m[1mæ‰§è¡Œå®Œæˆ[0m
[0m
[32m2025-10-09 12:05:22.421[0m | [1mINFO    [0m | [36m__main__[0m:[36mrun_workflow[0m:[36m117[0m - [1må·¥ä½œæµæ‰§è¡ŒæˆåŠŸï¼Œç»“æœï¼š{'response': '<think>\nå¥½çš„ï¼Œæˆ‘ç°åœ¨éœ€è¦æ ¹æ®ç”¨æˆ·æä¾›çš„ç»„ä»¶è¾“å…¥è¾“å‡ºå‚æ•°å®šä¹‰ã€å±æ€§å‚æ•°å®šä¹‰ä»¥åŠæ ·ä¾‹ä»£ç ï¼Œç”Ÿæˆä¸€ä¸ªæ•°æ®å½’ä¸€åŒ–ç»„ä»¶çš„Pythonä»£ç ã€‚é¦–å…ˆï¼Œæˆ‘éœ€è¦ç†è§£ç”¨æˆ·çš„éœ€æ±‚ã€‚ç”¨æˆ·æåˆ°è¦åˆ›å»ºä¸€ä¸ªæ•°æ®å½’ä¸€åŒ–ç»„ä»¶ï¼Œè¿™é€šå¸¸æ¶‰åŠå°†æ•°æ®ç¼©æ”¾åˆ°0-1çš„èŒƒå›´æˆ–è€…å…¶ä»–çš„å½’ä¸€åŒ–æ–¹æ³•ã€‚\n\né¦–å…ˆï¼Œæˆ‘éœ€è¦æŸ¥çœ‹ç”¨æˆ·æä¾›çš„æ ·ä¾‹ä»£ç ï¼Œäº†è§£å…¶ç»“æ„ã€‚æ ·ä¾‹ä¸­çš„Componentç±»æœ‰inputsã€outputsã€propertiesï¼Œä»¥åŠrunæ–¹æ³•ã€‚è¾“å…¥å¯èƒ½æ˜¯ä¸€ä¸ªå˜é‡å­—å…¸ï¼Œè¾“å‡ºæ˜¯ç”Ÿæˆçš„æç¤ºè¯ã€‚å±æ€§ä¸­æœ‰templateï¼Œç”¨äºæ¨¡æ¿æ›¿æ¢ã€‚\n\nç°åœ¨ï¼Œç”¨æˆ·éœ€è¦çš„æ˜¯æ•°æ®å½’ä¸€åŒ–ç»„ä»¶ï¼Œæ‰€ä»¥è¾“å…¥å¯èƒ½éœ€è¦ä¸€ä¸ªæ•°æ®åˆ—æˆ–çŸ©é˜µï¼Œè¾“å‡ºæ˜¯å½’ä¸€åŒ–åçš„æ•°æ®ã€‚å±æ€§å¯èƒ½éœ€è¦é€‰æ‹©å½’ä¸€åŒ–æ–¹æ³•ï¼ˆå¦‚Min-Maxã€Z-Scoreï¼‰ï¼Œå¯èƒ½è¿˜æœ‰æ˜¯å¦å¤„ç†ç¼ºå¤±å€¼ç­‰å‚æ•°ã€‚\n\næ¥ä¸‹æ¥ï¼Œæ ¹æ®ç”¨æˆ·çš„è¦æ±‚ï¼Œä»£ç ä¸éœ€è¦åŒ…å«è¾“å…¥è¾“å‡ºå‚æ•°å®šä¹‰ï¼Œè¿™äº›å·²ç»å­˜åœ¨ã€‚ç¬¬ä¸‰æ–¹åº“åªèƒ½åœ¨å‡½æ•°å†…éƒ¨å¯¼å…¥ï¼Œä¸èƒ½åœ¨æ–‡ä»¶å¼€å¤´ã€‚åŒæ—¶ï¼Œä¸èƒ½ä½¿ç”¨Dictã€Listè¿™äº›ç±»å‹æ³¨è§£ï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦ä½¿ç”¨æ™®é€šçš„å­—å…¸å’Œåˆ—è¡¨ã€‚\n\né¦–å…ˆï¼Œå®šä¹‰ç»„ä»¶çš„inputså’Œoutputsã€‚è¾“å…¥å¯èƒ½æ˜¯ä¸€ä¸ªæ•°æ®åˆ—ï¼Œç±»å‹å¯èƒ½æ˜¯ARRAYæˆ–CSVï¼Œè¾“å‡ºæ˜¯å½’ä¸€åŒ–åçš„æ•°æ®ï¼Œç±»å‹å¯èƒ½æ˜¯ARRAYã€‚ä¾‹å¦‚ï¼š\n\ninputs = [\n    PortDefinition(name="data", label="è¾“å…¥æ•°æ®", type=ArgumentType.ARRAY),\n]\noutputs = [\n    PortDefinition(name="normalized_data", label="å½’ä¸€åŒ–åçš„æ•°æ®", type=ArgumentType.ARRAY),\n]\n\nç„¶åï¼Œå±æ€§éƒ¨åˆ†éœ€è¦å®šä¹‰å½’ä¸€åŒ–æ–¹æ³•ï¼Œå¯èƒ½è¿˜æœ‰æ˜¯å¦ä½¿ç”¨z-scoreç­‰ã€‚ä¾‹å¦‚ï¼Œå±æ€§å¯èƒ½åŒ…æ‹¬methodï¼ˆä¸‹æ‹‰æ¡†ï¼Œé€‰é¡¹ä¸ºMin-Maxã€Z-Scoreï¼‰ï¼Œå¯èƒ½è¿˜æœ‰å…¶ä»–å‚æ•°å¦‚å¤„ç†ç¼ºå¤±å€¼çš„é€‰é¡¹ã€‚\n\nå±æ€§å®šä¹‰å¯èƒ½åƒï¼š\n\nproperties = {\n    "method": PropertyDefinition(\n        type=PropertyType.CHOICE,\n        default="minmax",\n        label="å½’ä¸€åŒ–æ–¹æ³•",\n        choices=["minmax", "zscore"],\n    ),\n    "handle_missing": PropertyDefinition(\n        type=PropertyType.CHOICE,\n        default="none",\n        label="å¤„ç†ç¼ºå¤±å€¼",\n        choices=["none", "mean", "median", "constant"],\n    ),\n    "constant_value": PropertyDefinition(\n        type=PropertyType.FLOAT,\n        default=0.0,\n        label="å¸¸é‡å€¼",\n        min=0.0,\n        max=100.0,\n        step=0.1,\n    ),\n}\n\nä¸è¿‡ï¼Œç”¨æˆ·å¯èƒ½å¸Œæœ›æ›´å…·ä½“çš„å‚æ•°ï¼Œæ¯”å¦‚æ˜¯å¦åº”ç”¨åˆ°æ‰€æœ‰ç‰¹å¾ï¼Œæˆ–è€…æ˜¯å¦æœ‰å…¶ä»–é€‰é¡¹ã€‚éœ€è¦æ ¹æ®å¸¸è§çš„å½’ä¸€åŒ–ç»„ä»¶æ¥è®¾è®¡å±æ€§ã€‚\n\næ¥ä¸‹æ¥ï¼Œrunæ–¹æ³•éœ€è¦å®ç°å½’ä¸€åŒ–é€»è¾‘ã€‚åœ¨å‡½æ•°å†…éƒ¨ï¼Œå¯èƒ½éœ€è¦å¯¼å…¥å¿…è¦çš„åº“ï¼Œå¦‚numpyæˆ–sklearnã€‚ä¾‹å¦‚ï¼Œå¯¹äºMin-Maxå½’ä¸€åŒ–ï¼Œå¯ä»¥ä½¿ç”¨ sklearn.preprocessing.MinMaxScalerï¼Œè€ŒZ-Scoreåˆ™ä½¿ç”¨StandardScalerã€‚ä½†ç”¨æˆ·è¦æ±‚åªèƒ½åœ¨å‡½æ•°å†…éƒ¨å¯¼å…¥ï¼Œæ‰€ä»¥éœ€è¦åœ¨runæ–¹æ³•ä¸­åŠ¨æ€å¯¼å…¥ã€‚\n\nå¤„ç†è¾“å…¥æ•°æ®æ—¶ï¼Œéœ€è¦å°†è¾“å…¥çš„æ•°æ®è½¬æ¢ä¸ºæ•°ç»„ï¼Œå¤„ç†ç¼ºå¤±å€¼ï¼Œç„¶ååº”ç”¨å½’ä¸€åŒ–æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š\n\ndef run(self, params, inputs=None):\n    import numpy as np\n    from sklearn.preprocessing import MinMaxScaler, StandardScaler\n\n    data = inputs.get("data", [])\n    method = params.get("method", "minmax")\n    handle_missing = params.get("handle_missing", "none")\n    constant_value = params.get("constant_value", 0.0)\n\n    # å¤„ç†ç¼ºå¤±å€¼\n    if handle_missing == "mean":\n        # è®¡ç®—å‡å€¼ï¼Œå¡«å……ç¼ºå¤±å€¼\n        data = np.array(data)\n        # è¿™é‡Œå¯èƒ½éœ€è¦æ›´å¤æ‚çš„å¤„ç†ï¼Œæ¯”å¦‚é€åˆ—è®¡ç®—å‡å€¼\n        # ç¤ºä¾‹ï¼šå‡è®¾dataæ˜¯äºŒç»´æ•°ç»„ï¼Œè®¡ç®—æ¯åˆ—çš„å‡å€¼\n        # è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…å¯èƒ½éœ€è¦æ›´å¤æ‚çš„é€»è¾‘\n        pass\n    # å…¶ä»–å¤„ç†ç¼ºå¤±å€¼çš„é€»è¾‘...\n\n    # åº”ç”¨å½’ä¸€åŒ–æ–¹æ³•\n    if method == "minmax":\n        scaler = MinMaxScaler()\n        normalized_data = scaler.fit_transform(data)\n    elif method == "zscore":\n        scaler = StandardScaler()\n        normalized_data = scaler.fit_transform(data)\n    else:\n        normalized_data = data\n\n    return {"normalized_data": normalized_data.tolist()}\n\nä¸è¿‡ï¼Œéœ€è¦è€ƒè™‘è¾“å…¥æ•°æ®çš„ç»“æ„ã€‚æ¯”å¦‚ï¼Œå¦‚æœè¾“å…¥æ˜¯äºŒç»´æ•°ç»„ï¼Œå¯èƒ½éœ€è¦å¤„ç†æ¯ä¸ªç‰¹å¾ã€‚å¦å¤–ï¼Œå¤„ç†ç¼ºå¤±å€¼çš„éƒ¨åˆ†éœ€è¦æ›´è¯¦ç»†çš„å®ç°ï¼Œæ¯”å¦‚ä½¿ç”¨numpyçš„nanå¤„ç†å‡½æ•°ã€‚\n\nå¦å¤–ï¼Œç”¨æˆ·å¯èƒ½å¸Œæœ›å±æ€§ä¸­çš„æŸäº›å‚æ•°æ ¹æ®é€‰æ‹©æ˜¾ç¤ºæˆ–éšè—ï¼Œæ¯”å¦‚å½“handle_missingè®¾ç½®ä¸ºconstantæ—¶ï¼Œæ˜¾ç¤ºconstant_valueå‚æ•°ã€‚ä½†æ ¹æ®ç”¨æˆ·æä¾›çš„PropertyDefinitionï¼Œå¯èƒ½æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦åœ¨å±æ€§ä¸­è®¾ç½®æ¡ä»¶ï¼Œä½†ç”¨æˆ·æä¾›çš„ä»£ç ä¸­æ²¡æœ‰æåˆ°ï¼Œå¯èƒ½ä¸éœ€è¦å¤„ç†ã€‚\n\næœ€åï¼Œç¡®ä¿ç»„ä»¶çš„nameã€categoryã€descriptionç­‰å±æ€§æ­£ç¡®ã€‚ä¾‹å¦‚ï¼š\n\nclass Component(BaseComponent):\n    name = "æ•°æ®å½’ä¸€åŒ–"\n    category = "æ•°æ®é¢„å¤„ç†ç»„ä»¶"\n    description = "å¯¹è¾“å…¥æ•°æ®è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼Œæ”¯æŒMin-Maxå’ŒZ-Scoreæ–¹æ³•ã€‚"\n\n    inputs = [...] \n    outputs = [...]\n    properties = {...}\n\néœ€è¦æ£€æŸ¥æ˜¯å¦ç¬¦åˆç”¨æˆ·æä¾›çš„æ ·ä¾‹ç»“æ„ï¼Œæ¯”å¦‚å±æ€§æ˜¯å¦ä½¿ç”¨æ­£ç¡®çš„ç±»å‹å’Œé»˜è®¤å€¼ã€‚\n\nå¯èƒ½è¿˜éœ€è¦å¤„ç†è¾“å…¥æ•°æ®çš„ç±»å‹è½¬æ¢ï¼Œæ¯”å¦‚å°†è¾“å…¥çš„åˆ—è¡¨è½¬æ¢ä¸ºnumpyæ•°ç»„ï¼Œæˆ–è€…å¤„ç†å¯èƒ½çš„å¼‚å¸¸æƒ…å†µã€‚\n\nç»¼ä¸Šï¼Œç”Ÿæˆçš„ä»£ç åº”è¯¥åŒ…æ‹¬æ­£ç¡®çš„è¾“å…¥è¾“å‡ºç«¯å£å®šä¹‰ï¼Œå±æ€§å®šä¹‰ï¼Œä»¥åŠå®ç°å½’ä¸€åŒ–é€»è¾‘çš„runæ–¹æ³•ï¼Œå…¶ä¸­å¯¼å…¥å¿…è¦çš„åº“åœ¨å‡½æ•°å†…éƒ¨ï¼Œå¹¶å¤„ç†å„ç§å‚æ•°ã€‚\n</think>\n\n```python\nclass Component(BaseComponent):\n    name = "æ•°æ®å½’ä¸€åŒ–"\n    category = "æ•°æ®é¢„å¤„ç†ç»„ä»¶"\n    description = "å¯¹è¾“å…¥æ•°æ®è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼Œæ”¯æŒMin-Maxå’ŒZ-Scoreæ–¹æ³•ã€‚"\n\n    inputs = [\n        PortDefinition(name="data", label="è¾“å…¥æ•°æ®", type=ArgumentType.ARRAY),\n    ]\n    outputs = [\n        PortDefinition(name="normalized_data", label="å½’ä¸€åŒ–åçš„æ•°æ®", type=ArgumentType.ARRAY),\n    ]\n\n    properties = {\n        "method": PropertyDefinition(\n            type=PropertyType.CHOICE,\n            default="minmax",\n            label="å½’ä¸€åŒ–æ–¹æ³•",\n            choices=["minmax", "zscore"],\n        ),\n        "handle_missing": PropertyDefinition(\n            type=PropertyType.CHOICE,\n            default="none",\n            label="å¤„ç†ç¼ºå¤±å€¼",\n            choices=["none", "mean", "median", "constant"],\n        ),\n        "constant_value": PropertyDefinition(\n            type=PropertyType.FLOAT,\n            default=0.0,\n            label="å¸¸é‡å€¼",\n            min=0.0,\n            max=100.0,\n            step=0.1,\n        ),\n    }\n\n    def run(self, params, inputs=None):\n        import numpy as np\n        from sklearn.preprocessing import MinMaxScaler, StandardScaler\n        \n        data = np.array(inputs.get("data", []))\n        method = params.get("method", "minmax")\n        handle_missing = params.get("handle_missing", "none")\n        constant_value = params.get("constant_value", 0.0)\n        \n        # å¤„ç†ç¼ºå¤±å€¼\n        if handle_missing == "mean":\n            data = np.nan_to_num(data, nan=np.nanmean(data))\n        elif handle_missing == "median":\n            data = np.nan_to_num(data, nan=np.nanmedian(data))\n        elif handle_missing == "constant":\n            data = np.nan_to_num(data, nan=constant_value)\n        \n        # æ‰§è¡Œå½’ä¸€åŒ–\n        if method == "minmax":\n            scaler = MinMaxScaler()\n            normalized_data = scaler.fit_transform(data)\n        elif method == "zscore":\n            scaler = StandardScaler()\n            normalized_data = scaler.fit_transform(data)\n        else:\n            normalized_data = data\n        \n        return {"normalized_data": normalized_data.tolist()}\n```'}[0m
INFO:     127.0.0.1:52229 - "POST /run HTTP/1.1" 200 OK
