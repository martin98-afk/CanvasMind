INFO:     Started server process [13748]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
[32m2025-10-09 23:13:44.997[0m | [1mINFO    [0m | [36mrunner.workflow_runner[0m:[36mexecute_workflow[0m:[36m139[0m - [1mæ‰§è¡ŒèŠ‚ç‚¹: é•¿æ–‡æœ¬è¾“å…¥ 1[0m
[32m2025-10-09 23:13:45.590[0m | [33m[1mWARNING [0m | [36mrunner.component_executor[0m:[36m_run_subprocess[0m:[36m173[0m - [33m[1må­è¿›ç¨‹ stderr:
[32m2025-10-09 23:13:45.545[0m | [32m[1mSUCCESS [0m | [36m__main__[0m:[36msuccess[0m:[36m27[0m - [32m[1mæ‰§è¡Œå®Œæˆ[0m
[0m
[32m2025-10-09 23:13:45.596[0m | [1mINFO    [0m | [36mrunner.workflow_runner[0m:[36mexecute_workflow[0m:[36m139[0m - [1mæ‰§è¡ŒèŠ‚ç‚¹: JSONæ–‡æœ¬åŒ…è£…[0m
[32m2025-10-09 23:13:46.198[0m | [33m[1mWARNING [0m | [36mrunner.component_executor[0m:[36m_run_subprocess[0m:[36m173[0m - [33m[1må­è¿›ç¨‹ stderr:
[32m2025-10-09 23:13:46.155[0m | [32m[1mSUCCESS [0m | [36m__main__[0m:[36msuccess[0m:[36m27[0m - [32m[1mæ‰§è¡Œå®Œæˆ[0m
[0m
[32m2025-10-09 23:13:46.204[0m | [1mINFO    [0m | [36mrunner.workflow_runner[0m:[36mexecute_workflow[0m:[36m139[0m - [1mæ‰§è¡ŒèŠ‚ç‚¹: æç¤ºè¯æ¨¡æ¿ 3[0m
[32m2025-10-09 23:13:46.828[0m | [33m[1mWARNING [0m | [36mrunner.component_executor[0m:[36m_run_subprocess[0m:[36m173[0m - [33m[1må­è¿›ç¨‹ stderr:
[32m2025-10-09 23:13:46.784[0m | [1mINFO    [0m | [36m__main__[0m:[36minfo[0m:[36m26[0m - [1m{'variables': {'text': 'æˆ‘çš„éœ€æ±‚æ˜¯å¼€å‘ä¸€ä¸ªé€»è¾‘å›å½’ç»„ä»¶'}}[0m
[32m2025-10-09 23:13:46.784[0m | [1mINFO    [0m | [36m__main__[0m:[36minfo[0m:[36m26[0m - [1m##  ä»»åŠ¡
æ ¹æ®æˆ‘çš„ç»„ä»¶è¾“å…¥ã€è¾“å‡ºã€èŠ‚ç‚¹å‚æ•°å®šä¹‰ä»¥åŠæˆ‘çš„æ ·ä¾‹ä»£ç ã€éœ€æ±‚ç­‰ä¿¡æ¯è‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„pythonç»„ä»¶ä»£ç 

## ç»„ä»¶è¾“å…¥è¾“å‡ºå‚æ•°å®šä¹‰ä»£ç 
class ArgumentType(str, Enum):
    """å‚æ•°ç±»å‹"""
    TEXT = "æ–‡æœ¬"
    INT = "æ•´æ•°"
    FLOAT = "æµ®ç‚¹æ•°"
    BOOL = "å¸ƒå°”å€¼"
    ARRAY = "åˆ—è¡¨"
    CSV = "csv"
    JSON = "json"
    EXCEL = "excel"
    FILE = "æ–‡ä»¶"
    UPLOAD = "ä¸Šä¼ "
    SKLEARNMODEL = "sklearnæ¨¡å‹"
    TORCHMODEL = "torchæ¨¡å‹"
    IMAGE = "å›¾ç‰‡"

class PortDefinition(BaseModel):
    """ç«¯å£å®šä¹‰"""
    name: str
    label: str
    type: ArgumentType = ArgumentType.TEXT

## ç»„ä»¶å±æ€§å‚æ•°å®šä¹‰ä»£ç 
class PropertyType(str, Enum):
    """å±æ€§ç±»å‹"""
    TEXT = "æ–‡æœ¬"
    LONGTEXT = "é•¿æ–‡æœ¬"
    INT = "æ•´æ•°"
    FLOAT = "æµ®ç‚¹æ•°"
    RANGE = "èŒƒå›´"
    BOOL = "å¤é€‰æ¡†"
    CHOICE = "ä¸‹æ‹‰æ¡†"
    DYNAMICFORM = "åŠ¨æ€è¡¨å•"


class PropertyDefinition(BaseModel):
    """å±æ€§å®šä¹‰"""
    type: PropertyType = PropertyType.TEXT
    default: Any = ""
    label: str = ""
    choices: List[str] = Field(default_factory=list)
    filter: str = "All Files (*)"  # ç”¨äºæ–‡ä»¶ç±»å‹è¿‡æ»¤
    schema: Optional[Dict[str, 'PropertyDefinition']] = Field(default=None)  # è¡¨å•å†…æ¯ä¸ªå­—æ®µçš„å®šä¹‰
    min: float = Field(default=0.0, description="æœ€å°å€¼")
    max: float = Field(default=100.0, description="æœ€å¤§å€¼")
    step: float = Field(default=1.0, description="æ­¥é•¿")

    class Config:
        # å…è®¸é€’å½’å¼•ç”¨
        arbitrary_types_allowed = True

## æˆ‘çš„ç»„ä»¶æ ·ä¾‹ä»£ç 
class Component(BaseComponent):
    name = "æç¤ºè¯æ¨¡æ¿"
    category = "å¤§æ¨¡å‹ç»„ä»¶"
    description = ""
    requirements = ""

    inputs = [
        PortDefinition(name="variables", label="å˜é‡å­—å…¸", type=ArgumentType.JSON),
    ]
    outputs = [
        PortDefinition(name="prompt", label="ç”Ÿæˆçš„æç¤ºè¯", type=ArgumentType.TEXT),
    ]

    properties = {
        "template": PropertyDefinition(
            type=PropertyType.LONGTEXT,
            default="""ä½ å¥½ï¼Œ{{name}}ï¼ä»Šå¤©æ˜¯{{day}}ã€‚""",
            label="æç¤ºè¯æ¨¡æ¿",
        ),
    }

    def run(self, params, inputs = None):
        import re
        self.logger.info(inputs)
        template = params.get("template", "")
        variables = inputs.get("variables", {}) if inputs else {}

        if isinstance(variables, str):
            import json
            try:
                variables = json.loads(variables)
            except:
                variables = {}

        # æ›¿æ¢ {{key}} ä¸ºå˜é‡å€¼
        def replace_match(match):
            key = match.group(1)
            return str(variables.get(key, match.group(0)))

        prompt = re.sub(r"\{\{(\w+)\}\}", replace_match, template)
        self.logger.info(prompt)
        
        return {"prompt": prompt}

## æˆ‘çš„ç»„ä»¶å¼€å‘éœ€æ±‚
æˆ‘çš„éœ€æ±‚æ˜¯å¼€å‘ä¸€ä¸ªé€»è¾‘å›å½’ç»„ä»¶

## ä»£ç è¾“å‡ºè¦æ±‚
è¾“å‡ºä»£ç ä¸éœ€è¦åŒ…å«è¾“å…¥ã€è¾“å‡ºä»¥åŠå±æ€§å‚æ•°å®šä¹‰ä»£ç ï¼Œè¿™éƒ¨åˆ†å·²ç»å†™å¥½äº†ï¼ŒåŒæ—¶ç¬¬ä¸‰æ–¹å·¥å…·åŒ…å¯¼å…¥æ—¶åªèƒ½åœ¨å‡½æ•°å†…å¯¼å…¥ï¼Œä¸èƒ½åœ¨æ–‡ä»¶å¼€å¤´å¯¼å…¥ï¼Œä¸è¦å¼•å…¥Dictï¼ŒListè¿™äº›å‚æ•°æ ¼å¼å®šä¹‰ã€‚

## ç”Ÿæˆçš„ç»„ä»¶ä»£ç 
[0m
[32m2025-10-09 23:13:46.784[0m | [32m[1mSUCCESS [0m | [36m__main__[0m:[36msuccess[0m:[36m27[0m - [32m[1mæ‰§è¡Œå®Œæˆ[0m
[0m
[32m2025-10-09 23:13:46.834[0m | [1mINFO    [0m | [36mrunner.workflow_runner[0m:[36mexecute_workflow[0m:[36m139[0m - [1mæ‰§è¡ŒèŠ‚ç‚¹: å¤§æ¨¡å‹å¯¹è¯[0m
[32m2025-10-09 23:13:58.345[0m | [33m[1mWARNING [0m | [36mrunner.component_executor[0m:[36m_run_subprocess[0m:[36m173[0m - [33m[1må­è¿›ç¨‹ stderr:
[32m2025-10-09 23:13:47.803[0m | [1mINFO    [0m | [36m__main__[0m:[36minfo[0m:[36m26[0m - [1mqwen/qwen3-30b-a3b[0m
[32m2025-10-09 23:13:47.803[0m | [1mINFO    [0m | [36m__main__[0m:[36minfo[0m:[36m26[0m - [1mä½ æ˜¯ä¸€ä¸ªä»£ç ç¼–è¾‘ä¸“å®¶ï¼Œèƒ½å¤Ÿæ ¹æ®ç”¨æˆ·çš„éœ€æ±‚ç”Ÿæˆä¸“ä¸šçš„pythonä»£ç ã€‚[0m
[32m2025-10-09 23:13:58.249[0m | [1mINFO    [0m | [36m__main__[0m:[36minfo[0m:[36m26[0m - [1mChatCompletion(id='chatcmpl-m7gfb4nlffa2464uryuva', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='<think>\nå¥½çš„ï¼Œæˆ‘éœ€è¦å¸®ç”¨æˆ·ç”Ÿæˆä¸€ä¸ªé€»è¾‘å›å½’ç»„ä»¶çš„Pythonä»£ç ã€‚æ ¹æ®ç”¨æˆ·æä¾›çš„è¾“å…¥è¾“å‡ºå‚æ•°å®šä¹‰ã€å±æ€§å‚æ•°å®šä¹‰ä»¥åŠæ ·ä¾‹ä»£ç ï¼Œæˆ‘å¾—å…ˆç†è§£ä»–ä»¬çš„éœ€æ±‚ã€‚\n\né¦–å…ˆï¼Œç”¨æˆ·çš„ç»„ä»¶éœ€è¦æœ‰è¾“å…¥å’Œè¾“å‡ºç«¯å£ã€‚æ ·ä¾‹ä¸­çš„Componentç±»æœ‰inputså’Œoutputsåˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯PortDefinitionå¯¹è±¡ã€‚é€»è¾‘å›å½’ç»„ä»¶å¯èƒ½éœ€è¦è¾“å…¥ç‰¹å¾æ•°æ®å’Œæ ‡ç­¾ï¼Œè¾“å‡ºæ¨¡å‹æˆ–è€…é¢„æµ‹ç»“æœã€‚ä¸è¿‡ç”¨æˆ·çš„éœ€æ±‚æ²¡æœ‰æ˜ç¡®è¯´æ˜ï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦å‡è®¾ã€‚\n\nç„¶åçœ‹å±æ€§å‚æ•°å®šä¹‰ï¼ŒPropertyDefinitionä¸­æœ‰å„ç§ç±»å‹ï¼Œæ¯”å¦‚æ–‡æœ¬ã€é•¿æ–‡æœ¬ã€æ•´æ•°ã€æµ®ç‚¹æ•°ç­‰ã€‚é€»è¾‘å›å½’é€šå¸¸æœ‰è¶…å‚æ•°ï¼Œæ¯”å¦‚æ­£åˆ™åŒ–å‚æ•°Cã€æƒ©ç½šæ–¹å¼ï¼ˆL1/L2ï¼‰ã€æœ€å¤§è¿­ä»£æ¬¡æ•°ç­‰ã€‚è¿™äº›åº”è¯¥ä½œä¸ºç»„ä»¶çš„å±æ€§ã€‚\n\nç”¨æˆ·è¦æ±‚ä»£ç ä¸­ä¸èƒ½åœ¨æ–‡ä»¶å¼€å¤´å¯¼å…¥ç¬¬ä¸‰æ–¹åº“ï¼Œåªèƒ½åœ¨å‡½æ•°å†…å¯¼å…¥ã€‚æ‰€ä»¥åƒsklearnçš„é€»è¾‘å›å½’æ¨¡å‹éœ€è¦åœ¨runæ–¹æ³•é‡Œå¯¼å…¥ã€‚\n\næ¥ä¸‹æ¥æ˜¯æ ·ä¾‹ä»£ç çš„ç»“æ„ã€‚Componentç±»ç»§æ‰¿è‡ªBaseComponentï¼Œæœ‰nameã€categoryã€descriptionã€requirementsç­‰å±æ€§ï¼Œä»¥åŠinputsã€outputsã€propertieså­—å…¸ã€‚runæ–¹æ³•å¤„ç†è¾“å…¥å‚æ•°å’Œæ•°æ®ï¼Œç”Ÿæˆè¾“å‡ºã€‚\n\nç°åœ¨å…·ä½“åˆ°é€»è¾‘å›å½’ç»„ä»¶ï¼Œå¯èƒ½éœ€è¦ä»¥ä¸‹æ­¥éª¤ï¼š\n\n1. å®šä¹‰è¾“å…¥ç«¯å£ï¼šæ¯”å¦‚ç‰¹å¾æ•°æ®ï¼ˆå¯èƒ½æ˜¯CSVæˆ–JSONæ ¼å¼ï¼‰ï¼Œæ ‡ç­¾æ•°æ®ã€‚\n2. è¾“å‡ºç«¯å£ï¼šè®­ç»ƒå¥½çš„æ¨¡å‹æˆ–è€…é¢„æµ‹ç»“æœã€‚\n3. å±æ€§å‚æ•°ï¼šå¦‚Cå€¼ã€æ­£åˆ™åŒ–ç±»å‹ã€æœ€å¤§è¿­ä»£æ¬¡æ•°ã€æ˜¯å¦æ ‡å‡†åŒ–ç­‰ã€‚\n\néœ€è¦æ³¨æ„ç”¨æˆ·æåˆ°çš„å±æ€§ç±»å‹ï¼Œæ¯”å¦‚Cæ˜¯æµ®ç‚¹æ•°ï¼Œå¯èƒ½ç”¨PropertyType.FLOATï¼›æ­£åˆ™åŒ–ç±»å‹å¯èƒ½æ˜¯ä¸‹æ‹‰æ¡†é€‰æ‹©L1/L2ï¼Œæ‰€ä»¥ç”¨CHOICEç±»å‹ã€‚æ˜¯å¦æœ‰å…¶ä»–å‚æ•°éœ€è¦è€ƒè™‘ï¼Ÿæ¯”å¦‚solverçš„é€‰æ‹©ï¼Œæˆ–è€…æ˜¯å¦ä½¿ç”¨æ¦‚ç‡ä¼°è®¡ç­‰ã€‚\n\nç„¶åï¼Œåœ¨runæ–¹æ³•ä¸­ï¼Œæ ¹æ®å‚æ•°åˆå§‹åŒ–é€»è¾‘å›å½’æ¨¡å‹ï¼Œè®­ç»ƒæ•°æ®ï¼Œå¹¶ä¿å­˜æ¨¡å‹æˆ–è€…ç”Ÿæˆé¢„æµ‹ç»“æœã€‚ä½†ç”¨æˆ·çš„éœ€æ±‚å¯èƒ½æ˜¯æŒ‡è®­ç»ƒç»„ä»¶è¿˜æ˜¯é¢„æµ‹ç»„ä»¶ï¼Ÿå‡è®¾æ˜¯è®­ç»ƒç»„ä»¶ï¼Œè¾“å‡ºæ¨¡å‹ã€‚\n\nå¦å¤–ï¼Œç”¨æˆ·çš„æ ·ä¾‹ä»£ç ä¸­inputsæ˜¯variableså­—å…¸ï¼Œè€Œè¿™é‡Œå¯èƒ½éœ€è¦å¤„ç†ç‰¹å¾å’Œæ ‡ç­¾ã€‚æ¯”å¦‚è¾“å…¥ç«¯å£å¯èƒ½æ˜¯Xï¼ˆç‰¹å¾ï¼‰å’Œyï¼ˆæ ‡ç­¾ï¼‰ï¼Œè¾“å‡ºæ˜¯æ¨¡å‹ã€‚\n\nä¸è¿‡ç”¨æˆ·æä¾›çš„æ ·ä¾‹ä¸­çš„inputsæ˜¯ä¸€ä¸ªå˜é‡å­—å…¸ï¼Œå¯èƒ½è¿™é‡Œçš„é€»è¾‘å›å½’ç»„ä»¶éœ€è¦æ¥æ”¶è®­ç»ƒæ•°æ®ä½œä¸ºè¾“å…¥ï¼Œå¹¶ç”Ÿæˆæ¨¡å‹ä½œä¸ºè¾“å‡ºã€‚æˆ–è€…å¦‚æœæ˜¯é¢„æµ‹ç»„ä»¶ï¼Œåˆ™è¾“å…¥æ˜¯æ¨¡å‹å’Œæ•°æ®ï¼Œè¾“å‡ºæ˜¯é¢„æµ‹ç»“æœã€‚ä½†æ ¹æ®éœ€æ±‚æè¿°â€œå¼€å‘ä¸€ä¸ªé€»è¾‘å›å½’ç»„ä»¶â€ï¼Œå¯èƒ½æŒ‡è®­ç»ƒç»„ä»¶ã€‚\n\næ‰€ä»¥ï¼Œå¯èƒ½çš„è¾“å…¥ç«¯å£åŒ…æ‹¬ç‰¹å¾æ•°æ®ï¼ˆCSVæˆ–JSONï¼‰å’Œæ ‡ç­¾æ•°æ®ï¼ˆCSVæˆ–JSONï¼‰ï¼Œè¾“å‡ºæ˜¯è®­ç»ƒå¥½çš„æ¨¡å‹ï¼ˆSKLEARNMODELç±»å‹ï¼‰ã€‚å±æ€§å‚æ•°åŒ…æ‹¬Cã€æ­£åˆ™åŒ–ç±»å‹ã€æœ€å¤§è¿­ä»£æ¬¡æ•°ç­‰ã€‚\n\nç°åœ¨éœ€è¦å°†è¿™äº›è½¬åŒ–ä¸ºä»£ç ã€‚ä¾‹å¦‚ï¼š\n\ninputs = [\n    PortDefinition(name="X", label="ç‰¹å¾æ•°æ®", type=ArgumentType.CSV),\n    PortDefinition(name="y", label="æ ‡ç­¾æ•°æ®", type=ArgumentType.CSV),\n]\noutputs = [\n    PortDefinition(name="model", label="è®­ç»ƒå¥½çš„æ¨¡å‹", type=ArgumentType.SKLEARNMODEL),\n]\n\nproperties = {\n    "C": PropertyDefinition(type=PropertyType.FLOAT, default=1.0, label="æ­£åˆ™åŒ–å¼ºåº¦"),\n    "penalty": PropertyDefinition(type=PropertyType.CHOICE, choices=["l1", "l2"], default="l2", label="æ­£åˆ™åŒ–ç±»å‹"),\n    "max_iter": PropertyDefinition(type=PropertyType.INT, default=100, label="æœ€å¤§è¿­ä»£æ¬¡æ•°"),\n    # å…¶ä»–å‚æ•°å¦‚solverå¯èƒ½éœ€è¦æ›´å¤šå¤„ç†\n}\n\nç„¶ååœ¨runæ–¹æ³•ä¸­ï¼Œè¯»å–Xå’Œyçš„æ•°æ®ï¼Œè®­ç»ƒæ¨¡å‹ã€‚æ³¨æ„ç”¨æˆ·è¦æ±‚å¯¼å…¥åªèƒ½åœ¨å‡½æ•°å†…è¿›è¡Œï¼Œæ‰€ä»¥éœ€è¦åœ¨runé‡Œimport sklearnçš„é€»è¾‘å›å½’ã€‚\n\nä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¾“å…¥æ˜¯CSVï¼Œå¯èƒ½éœ€è¦ç”¨pandasè¯»å–ï¼ŒåŒæ ·åœ¨å‡½æ•°å†…éƒ¨å¯¼å…¥pandasã€‚ä¸è¿‡ç”¨æˆ·å¯èƒ½å¸Œæœ›å¤„ç†ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚JSONæˆ–CSVï¼Œè¿™å¯èƒ½éœ€è¦æ ¹æ®typeæ¥è§£æã€‚\n\nä¾‹å¦‚ï¼Œåœ¨runæ–¹æ³•ä¸­ï¼š\n\ndef run(self, params, inputs=None):\n    import pandas as pd\n    from sklearn.linear_model import LogisticRegression\n    # å¤„ç†è¾“å…¥æ•°æ®\n    X = inputs.get("X")\n    y = inputs.get("y")\n    # è§£æXå’Œyçš„æ•°æ®ï¼Œå¯èƒ½éœ€è¦æ ¹æ®typeå¤„ç†\n    # å‡è®¾Xå’Œyæ˜¯CSVæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œè½¬æ¢ä¸ºDataFrame\n    if isinstance(X, str):\n        X = pd.read_csv(pd.StringIO(X))\n    if isinstance(y, str):\n        y = pd.read_csv(pd.StringIO(y)).iloc[:, 0]  # å‡è®¾æ ‡ç­¾æ˜¯ä¸€åˆ—\n    # åˆå§‹åŒ–æ¨¡å‹\n    model = LogisticRegression(\n        C=params.get("C", 1.0),\n        penalty=params.get("penalty", "l2"),\n        max_iter=params.get("max_iter", 100)\n    )\n    model.fit(X, y)\n    return {"model": model}\n\nä½†éœ€è¦è€ƒè™‘è¾“å…¥æ•°æ®çš„æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼Œä»¥åŠå¦‚ä½•å¤„ç†ã€‚æ­¤å¤–ï¼Œç”¨æˆ·å¯èƒ½å¸Œæœ›æ¨¡å‹ä»¥æŸç§æ–¹å¼ä¿å­˜ï¼Œæ¯”å¦‚åºåˆ—åŒ–ä¸ºæ–‡ä»¶æˆ–ç›´æ¥è¿”å›å¯¹è±¡ã€‚\n\nå¦å¤–ï¼Œç”¨æˆ·æ ·ä¾‹ä¸­çš„inputsæ˜¯variableså­—å…¸ï¼Œè€Œè¿™é‡Œçš„é€»è¾‘å›å½’ç»„ä»¶å¯èƒ½éœ€è¦ä¸åŒçš„ç»“æ„ã€‚å¯èƒ½éœ€è¦è°ƒæ•´è¾“å…¥ç«¯å£çš„å®šä¹‰ã€‚\n\nè¿˜éœ€è¦æ£€æŸ¥å±æ€§å‚æ•°çš„ç±»å‹æ˜¯å¦æ­£ç¡®ï¼Œä¾‹å¦‚penaltyæ˜¯CHOICEç±»å‹ï¼Œchoicesè®¾ç½®ä¸º["l1", "l2"]ç­‰ã€‚\n\næœ€åï¼Œç¡®ä¿ä»£ç ç¬¦åˆç”¨æˆ·çš„æ ¼å¼è¦æ±‚ï¼šä¸åŒ…å«è¾“å…¥è¾“å‡ºå’Œå±æ€§å®šä¹‰ä»£ç ï¼Œç¬¬ä¸‰æ–¹åº“åœ¨å‡½æ•°å†…å¯¼å…¥ï¼Œä¸ä½¿ç”¨Dictã€Listç­‰ç±»å‹æç¤ºã€‚\n</think>\n\n```python\nclass Component(BaseComponent):\n    name = "é€»è¾‘å›å½’è®­ç»ƒ"\n    category = "æœºå™¨å­¦ä¹ ç»„ä»¶"\n    description = "åŸºäºé€»è¾‘å›å½’ç®—æ³•çš„åˆ†ç±»æ¨¡å‹è®­ç»ƒç»„ä»¶"\n    requirements = "scikit-learn pandas"\n\n    inputs = [\n        PortDefinition(name="X", label="ç‰¹å¾æ•°æ®", type=ArgumentType.CSV),\n        PortDefinition(name="y", label="æ ‡ç­¾æ•°æ®", type=ArgumentType.CSV),\n    ]\n    outputs = [\n        PortDefinition(name="model", label="è®­ç»ƒå¥½çš„æ¨¡å‹", type=ArgumentType.SKLEARNMODEL),\n    ]\n\n    properties = {\n        "C": PropertyDefinition(\n            type=PropertyType.FLOAT,\n            default=1.0,\n            label="æ­£åˆ™åŒ–å¼ºåº¦",\n            min=0.001,\n            max=100.0,\n            step=0.1\n        ),\n        "penalty": PropertyDefinition(\n            type=PropertyType.CHOICE,\n            choices=["l1", "l2", "elasticnet", "none"],\n            default="l2",\n            label="æ­£åˆ™åŒ–ç±»å‹"\n        ),\n        "max_iter": PropertyDefinition(\n            type=PropertyType.INT,\n            default=100,\n            label="æœ€å¤§è¿­ä»£æ¬¡æ•°",\n            min=1,\n            max=10000\n        ),\n        "solver": PropertyDefinition(\n            type=PropertyType.CHOICE,\n            choices=["liblinear", "lbfgs", "sag", "saga"],\n            default="lbfgs",\n            label="ä¼˜åŒ–ç®—æ³•"\n        ),\n        "random_state": PropertyDefinition(\n            type=PropertyType.INT,\n            default=42,\n            label="éšæœºç§å­"\n        )\n    }\n\n    def run(self, params, inputs=None):\n        import pandas as pd\n        from sklearn.linear_model import LogisticRegression\n        from sklearn.preprocessing import StandardScaler\n        \n        # å¤„ç†è¾“å…¥æ•°æ®\n        X_data = inputs.get("X", "")\n        y_data = inputs.get("y", "")\n        \n        # è§£æCSVæ•°æ®\n        if isinstance(X_data, str):\n            X = pd.read_csv(pd.StringIO(X_data))\n        else:\n            X = X_data\n            \n        if isinstance(y_data, str):\n            y = pd.read_csv(pd.StringIO(y_data)).iloc[:, 0]\n        else:\n            y = y_data\n        \n        # æ ‡å‡†åŒ–å¤„ç†\n        scaler = StandardScaler()\n        X_scaled = scaler.fit_transform(X)\n        \n        # åˆå§‹åŒ–æ¨¡å‹\n        model = LogisticRegression(\n            C=params.get("C", 1.0),\n            penalty=params.get("penalty", "l2"),\n            max_iter=params.get("max_iter", 100),\n            solver=params.get("solver", "lbfgs"),\n            random_state=params.get("random_state", 42)\n        )\n        \n        # è®­ç»ƒæ¨¡å‹\n        model.fit(X_scaled, y)\n        \n        return {"model": model}\n```', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=[]))], created=1760022828, model='qwen/qwen3-30b-a3b', object='chat.completion', service_tier=None, system_fingerprint='qwen/qwen3-30b-a3b', usage=CompletionUsage(completion_tokens=1760, prompt_tokens=806, total_tokens=2566, completion_tokens_details=None, prompt_tokens_details=None), stats={})[0m
[32m2025-10-09 23:13:58.251[0m | [32m[1mSUCCESS [0m | [36m__main__[0m:[36msuccess[0m:[36m27[0m - [32m[1mæ‰§è¡Œå®Œæˆ[0m
[0m
[32m2025-10-09 23:13:58.352[0m | [1mINFO    [0m | [36m__main__[0m:[36mrun_workflow[0m:[36m117[0m - [1må·¥ä½œæµæ‰§è¡ŒæˆåŠŸï¼Œç»“æœï¼š{'response': '<think>\nå¥½çš„ï¼Œæˆ‘éœ€è¦å¸®ç”¨æˆ·ç”Ÿæˆä¸€ä¸ªé€»è¾‘å›å½’ç»„ä»¶çš„Pythonä»£ç ã€‚æ ¹æ®ç”¨æˆ·æä¾›çš„è¾“å…¥è¾“å‡ºå‚æ•°å®šä¹‰ã€å±æ€§å‚æ•°å®šä¹‰ä»¥åŠæ ·ä¾‹ä»£ç ï¼Œæˆ‘å¾—å…ˆç†è§£ä»–ä»¬çš„éœ€æ±‚ã€‚\n\né¦–å…ˆï¼Œç”¨æˆ·çš„ç»„ä»¶éœ€è¦æœ‰è¾“å…¥å’Œè¾“å‡ºç«¯å£ã€‚æ ·ä¾‹ä¸­çš„Componentç±»æœ‰inputså’Œoutputsåˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯PortDefinitionå¯¹è±¡ã€‚é€»è¾‘å›å½’ç»„ä»¶å¯èƒ½éœ€è¦è¾“å…¥ç‰¹å¾æ•°æ®å’Œæ ‡ç­¾ï¼Œè¾“å‡ºæ¨¡å‹æˆ–è€…é¢„æµ‹ç»“æœã€‚ä¸è¿‡ç”¨æˆ·çš„éœ€æ±‚æ²¡æœ‰æ˜ç¡®è¯´æ˜ï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦å‡è®¾ã€‚\n\nç„¶åçœ‹å±æ€§å‚æ•°å®šä¹‰ï¼ŒPropertyDefinitionä¸­æœ‰å„ç§ç±»å‹ï¼Œæ¯”å¦‚æ–‡æœ¬ã€é•¿æ–‡æœ¬ã€æ•´æ•°ã€æµ®ç‚¹æ•°ç­‰ã€‚é€»è¾‘å›å½’é€šå¸¸æœ‰è¶…å‚æ•°ï¼Œæ¯”å¦‚æ­£åˆ™åŒ–å‚æ•°Cã€æƒ©ç½šæ–¹å¼ï¼ˆL1/L2ï¼‰ã€æœ€å¤§è¿­ä»£æ¬¡æ•°ç­‰ã€‚è¿™äº›åº”è¯¥ä½œä¸ºç»„ä»¶çš„å±æ€§ã€‚\n\nç”¨æˆ·è¦æ±‚ä»£ç ä¸­ä¸èƒ½åœ¨æ–‡ä»¶å¼€å¤´å¯¼å…¥ç¬¬ä¸‰æ–¹åº“ï¼Œåªèƒ½åœ¨å‡½æ•°å†…å¯¼å…¥ã€‚æ‰€ä»¥åƒsklearnçš„é€»è¾‘å›å½’æ¨¡å‹éœ€è¦åœ¨runæ–¹æ³•é‡Œå¯¼å…¥ã€‚\n\næ¥ä¸‹æ¥æ˜¯æ ·ä¾‹ä»£ç çš„ç»“æ„ã€‚Componentç±»ç»§æ‰¿è‡ªBaseComponentï¼Œæœ‰nameã€categoryã€descriptionã€requirementsç­‰å±æ€§ï¼Œä»¥åŠinputsã€outputsã€propertieså­—å…¸ã€‚runæ–¹æ³•å¤„ç†è¾“å…¥å‚æ•°å’Œæ•°æ®ï¼Œç”Ÿæˆè¾“å‡ºã€‚\n\nç°åœ¨å…·ä½“åˆ°é€»è¾‘å›å½’ç»„ä»¶ï¼Œå¯èƒ½éœ€è¦ä»¥ä¸‹æ­¥éª¤ï¼š\n\n1. å®šä¹‰è¾“å…¥ç«¯å£ï¼šæ¯”å¦‚ç‰¹å¾æ•°æ®ï¼ˆå¯èƒ½æ˜¯CSVæˆ–JSONæ ¼å¼ï¼‰ï¼Œæ ‡ç­¾æ•°æ®ã€‚\n2. è¾“å‡ºç«¯å£ï¼šè®­ç»ƒå¥½çš„æ¨¡å‹æˆ–è€…é¢„æµ‹ç»“æœã€‚\n3. å±æ€§å‚æ•°ï¼šå¦‚Cå€¼ã€æ­£åˆ™åŒ–ç±»å‹ã€æœ€å¤§è¿­ä»£æ¬¡æ•°ã€æ˜¯å¦æ ‡å‡†åŒ–ç­‰ã€‚\n\néœ€è¦æ³¨æ„ç”¨æˆ·æåˆ°çš„å±æ€§ç±»å‹ï¼Œæ¯”å¦‚Cæ˜¯æµ®ç‚¹æ•°ï¼Œå¯èƒ½ç”¨PropertyType.FLOATï¼›æ­£åˆ™åŒ–ç±»å‹å¯èƒ½æ˜¯ä¸‹æ‹‰æ¡†é€‰æ‹©L1/L2ï¼Œæ‰€ä»¥ç”¨CHOICEç±»å‹ã€‚æ˜¯å¦æœ‰å…¶ä»–å‚æ•°éœ€è¦è€ƒè™‘ï¼Ÿæ¯”å¦‚solverçš„é€‰æ‹©ï¼Œæˆ–è€…æ˜¯å¦ä½¿ç”¨æ¦‚ç‡ä¼°è®¡ç­‰ã€‚\n\nç„¶åï¼Œåœ¨runæ–¹æ³•ä¸­ï¼Œæ ¹æ®å‚æ•°åˆå§‹åŒ–é€»è¾‘å›å½’æ¨¡å‹ï¼Œè®­ç»ƒæ•°æ®ï¼Œå¹¶ä¿å­˜æ¨¡å‹æˆ–è€…ç”Ÿæˆé¢„æµ‹ç»“æœã€‚ä½†ç”¨æˆ·çš„éœ€æ±‚å¯èƒ½æ˜¯æŒ‡è®­ç»ƒç»„ä»¶è¿˜æ˜¯é¢„æµ‹ç»„ä»¶ï¼Ÿå‡è®¾æ˜¯è®­ç»ƒç»„ä»¶ï¼Œè¾“å‡ºæ¨¡å‹ã€‚\n\nå¦å¤–ï¼Œç”¨æˆ·çš„æ ·ä¾‹ä»£ç ä¸­inputsæ˜¯variableså­—å…¸ï¼Œè€Œè¿™é‡Œå¯èƒ½éœ€è¦å¤„ç†ç‰¹å¾å’Œæ ‡ç­¾ã€‚æ¯”å¦‚è¾“å…¥ç«¯å£å¯èƒ½æ˜¯Xï¼ˆç‰¹å¾ï¼‰å’Œyï¼ˆæ ‡ç­¾ï¼‰ï¼Œè¾“å‡ºæ˜¯æ¨¡å‹ã€‚\n\nä¸è¿‡ç”¨æˆ·æä¾›çš„æ ·ä¾‹ä¸­çš„inputsæ˜¯ä¸€ä¸ªå˜é‡å­—å…¸ï¼Œå¯èƒ½è¿™é‡Œçš„é€»è¾‘å›å½’ç»„ä»¶éœ€è¦æ¥æ”¶è®­ç»ƒæ•°æ®ä½œä¸ºè¾“å…¥ï¼Œå¹¶ç”Ÿæˆæ¨¡å‹ä½œä¸ºè¾“å‡ºã€‚æˆ–è€…å¦‚æœæ˜¯é¢„æµ‹ç»„ä»¶ï¼Œåˆ™è¾“å…¥æ˜¯æ¨¡å‹å’Œæ•°æ®ï¼Œè¾“å‡ºæ˜¯é¢„æµ‹ç»“æœã€‚ä½†æ ¹æ®éœ€æ±‚æè¿°â€œå¼€å‘ä¸€ä¸ªé€»è¾‘å›å½’ç»„ä»¶â€ï¼Œå¯èƒ½æŒ‡è®­ç»ƒç»„ä»¶ã€‚\n\næ‰€ä»¥ï¼Œå¯èƒ½çš„è¾“å…¥ç«¯å£åŒ…æ‹¬ç‰¹å¾æ•°æ®ï¼ˆCSVæˆ–JSONï¼‰å’Œæ ‡ç­¾æ•°æ®ï¼ˆCSVæˆ–JSONï¼‰ï¼Œè¾“å‡ºæ˜¯è®­ç»ƒå¥½çš„æ¨¡å‹ï¼ˆSKLEARNMODELç±»å‹ï¼‰ã€‚å±æ€§å‚æ•°åŒ…æ‹¬Cã€æ­£åˆ™åŒ–ç±»å‹ã€æœ€å¤§è¿­ä»£æ¬¡æ•°ç­‰ã€‚\n\nç°åœ¨éœ€è¦å°†è¿™äº›è½¬åŒ–ä¸ºä»£ç ã€‚ä¾‹å¦‚ï¼š\n\ninputs = [\n    PortDefinition(name="X", label="ç‰¹å¾æ•°æ®", type=ArgumentType.CSV),\n    PortDefinition(name="y", label="æ ‡ç­¾æ•°æ®", type=ArgumentType.CSV),\n]\noutputs = [\n    PortDefinition(name="model", label="è®­ç»ƒå¥½çš„æ¨¡å‹", type=ArgumentType.SKLEARNMODEL),\n]\n\nproperties = {\n    "C": PropertyDefinition(type=PropertyType.FLOAT, default=1.0, label="æ­£åˆ™åŒ–å¼ºåº¦"),\n    "penalty": PropertyDefinition(type=PropertyType.CHOICE, choices=["l1", "l2"], default="l2", label="æ­£åˆ™åŒ–ç±»å‹"),\n    "max_iter": PropertyDefinition(type=PropertyType.INT, default=100, label="æœ€å¤§è¿­ä»£æ¬¡æ•°"),\n    # å…¶ä»–å‚æ•°å¦‚solverå¯èƒ½éœ€è¦æ›´å¤šå¤„ç†\n}\n\nç„¶ååœ¨runæ–¹æ³•ä¸­ï¼Œè¯»å–Xå’Œyçš„æ•°æ®ï¼Œè®­ç»ƒæ¨¡å‹ã€‚æ³¨æ„ç”¨æˆ·è¦æ±‚å¯¼å…¥åªèƒ½åœ¨å‡½æ•°å†…è¿›è¡Œï¼Œæ‰€ä»¥éœ€è¦åœ¨runé‡Œimport sklearnçš„é€»è¾‘å›å½’ã€‚\n\nä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¾“å…¥æ˜¯CSVï¼Œå¯èƒ½éœ€è¦ç”¨pandasè¯»å–ï¼ŒåŒæ ·åœ¨å‡½æ•°å†…éƒ¨å¯¼å…¥pandasã€‚ä¸è¿‡ç”¨æˆ·å¯èƒ½å¸Œæœ›å¤„ç†ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚JSONæˆ–CSVï¼Œè¿™å¯èƒ½éœ€è¦æ ¹æ®typeæ¥è§£æã€‚\n\nä¾‹å¦‚ï¼Œåœ¨runæ–¹æ³•ä¸­ï¼š\n\ndef run(self, params, inputs=None):\n    import pandas as pd\n    from sklearn.linear_model import LogisticRegression\n    # å¤„ç†è¾“å…¥æ•°æ®\n    X = inputs.get("X")\n    y = inputs.get("y")\n    # è§£æXå’Œyçš„æ•°æ®ï¼Œå¯èƒ½éœ€è¦æ ¹æ®typeå¤„ç†\n    # å‡è®¾Xå’Œyæ˜¯CSVæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œè½¬æ¢ä¸ºDataFrame\n    if isinstance(X, str):\n        X = pd.read_csv(pd.StringIO(X))\n    if isinstance(y, str):\n        y = pd.read_csv(pd.StringIO(y)).iloc[:, 0]  # å‡è®¾æ ‡ç­¾æ˜¯ä¸€åˆ—\n    # åˆå§‹åŒ–æ¨¡å‹\n    model = LogisticRegression(\n        C=params.get("C", 1.0),\n        penalty=params.get("penalty", "l2"),\n        max_iter=params.get("max_iter", 100)\n    )\n    model.fit(X, y)\n    return {"model": model}\n\nä½†éœ€è¦è€ƒè™‘è¾“å…¥æ•°æ®çš„æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼Œä»¥åŠå¦‚ä½•å¤„ç†ã€‚æ­¤å¤–ï¼Œç”¨æˆ·å¯èƒ½å¸Œæœ›æ¨¡å‹ä»¥æŸç§æ–¹å¼ä¿å­˜ï¼Œæ¯”å¦‚åºåˆ—åŒ–ä¸ºæ–‡ä»¶æˆ–ç›´æ¥è¿”å›å¯¹è±¡ã€‚\n\nå¦å¤–ï¼Œç”¨æˆ·æ ·ä¾‹ä¸­çš„inputsæ˜¯variableså­—å…¸ï¼Œè€Œè¿™é‡Œçš„é€»è¾‘å›å½’ç»„ä»¶å¯èƒ½éœ€è¦ä¸åŒçš„ç»“æ„ã€‚å¯èƒ½éœ€è¦è°ƒæ•´è¾“å…¥ç«¯å£çš„å®šä¹‰ã€‚\n\nè¿˜éœ€è¦æ£€æŸ¥å±æ€§å‚æ•°çš„ç±»å‹æ˜¯å¦æ­£ç¡®ï¼Œä¾‹å¦‚penaltyæ˜¯CHOICEç±»å‹ï¼Œchoicesè®¾ç½®ä¸º["l1", "l2"]ç­‰ã€‚\n\næœ€åï¼Œç¡®ä¿ä»£ç ç¬¦åˆç”¨æˆ·çš„æ ¼å¼è¦æ±‚ï¼šä¸åŒ…å«è¾“å…¥è¾“å‡ºå’Œå±æ€§å®šä¹‰ä»£ç ï¼Œç¬¬ä¸‰æ–¹åº“åœ¨å‡½æ•°å†…å¯¼å…¥ï¼Œä¸ä½¿ç”¨Dictã€Listç­‰ç±»å‹æç¤ºã€‚\n</think>\n\n```python\nclass Component(BaseComponent):\n    name = "é€»è¾‘å›å½’è®­ç»ƒ"\n    category = "æœºå™¨å­¦ä¹ ç»„ä»¶"\n    description = "åŸºäºé€»è¾‘å›å½’ç®—æ³•çš„åˆ†ç±»æ¨¡å‹è®­ç»ƒç»„ä»¶"\n    requirements = "scikit-learn pandas"\n\n    inputs = [\n        PortDefinition(name="X", label="ç‰¹å¾æ•°æ®", type=ArgumentType.CSV),\n        PortDefinition(name="y", label="æ ‡ç­¾æ•°æ®", type=ArgumentType.CSV),\n    ]\n    outputs = [\n        PortDefinition(name="model", label="è®­ç»ƒå¥½çš„æ¨¡å‹", type=ArgumentType.SKLEARNMODEL),\n    ]\n\n    properties = {\n        "C": PropertyDefinition(\n            type=PropertyType.FLOAT,\n            default=1.0,\n            label="æ­£åˆ™åŒ–å¼ºåº¦",\n            min=0.001,\n            max=100.0,\n            step=0.1\n        ),\n        "penalty": PropertyDefinition(\n            type=PropertyType.CHOICE,\n            choices=["l1", "l2", "elasticnet", "none"],\n            default="l2",\n            label="æ­£åˆ™åŒ–ç±»å‹"\n        ),\n        "max_iter": PropertyDefinition(\n            type=PropertyType.INT,\n            default=100,\n            label="æœ€å¤§è¿­ä»£æ¬¡æ•°",\n            min=1,\n            max=10000\n        ),\n        "solver": PropertyDefinition(\n            type=PropertyType.CHOICE,\n            choices=["liblinear", "lbfgs", "sag", "saga"],\n            default="lbfgs",\n            label="ä¼˜åŒ–ç®—æ³•"\n        ),\n        "random_state": PropertyDefinition(\n            type=PropertyType.INT,\n            default=42,\n            label="éšæœºç§å­"\n        )\n    }\n\n    def run(self, params, inputs=None):\n        import pandas as pd\n        from sklearn.linear_model import LogisticRegression\n        from sklearn.preprocessing import StandardScaler\n        \n        # å¤„ç†è¾“å…¥æ•°æ®\n        X_data = inputs.get("X", "")\n        y_data = inputs.get("y", "")\n        \n        # è§£æCSVæ•°æ®\n        if isinstance(X_data, str):\n            X = pd.read_csv(pd.StringIO(X_data))\n        else:\n            X = X_data\n            \n        if isinstance(y_data, str):\n            y = pd.read_csv(pd.StringIO(y_data)).iloc[:, 0]\n        else:\n            y = y_data\n        \n        # æ ‡å‡†åŒ–å¤„ç†\n        scaler = StandardScaler()\n        X_scaled = scaler.fit_transform(X)\n        \n        # åˆå§‹åŒ–æ¨¡å‹\n        model = LogisticRegression(\n            C=params.get("C", 1.0),\n            penalty=params.get("penalty", "l2"),\n            max_iter=params.get("max_iter", 100),\n            solver=params.get("solver", "lbfgs"),\n            random_state=params.get("random_state", 42)\n        )\n        \n        # è®­ç»ƒæ¨¡å‹\n        model.fit(X_scaled, y)\n        \n        return {"model": model}\n```'}[0m
INFO:     127.0.0.1:56102 - "POST /run HTTP/1.1" 200 OK
[32m2025-10-09 23:14:09.896[0m | [1mINFO    [0m | [36mrunner.workflow_runner[0m:[36mexecute_workflow[0m:[36m139[0m - [1mæ‰§è¡ŒèŠ‚ç‚¹: é•¿æ–‡æœ¬è¾“å…¥ 1[0m
[32m2025-10-09 23:14:10.547[0m | [33m[1mWARNING [0m | [36mrunner.component_executor[0m:[36m_run_subprocess[0m:[36m173[0m - [33m[1må­è¿›ç¨‹ stderr:
[32m2025-10-09 23:14:10.499[0m | [32m[1mSUCCESS [0m | [36m__main__[0m:[36msuccess[0m:[36m27[0m - [32m[1mæ‰§è¡Œå®Œæˆ[0m
[0m
[32m2025-10-09 23:14:10.549[0m | [1mINFO    [0m | [36mrunner.workflow_runner[0m:[36mexecute_workflow[0m:[36m139[0m - [1mæ‰§è¡ŒèŠ‚ç‚¹: JSONæ–‡æœ¬åŒ…è£…[0m
[32m2025-10-09 23:14:11.157[0m | [33m[1mWARNING [0m | [36mrunner.component_executor[0m:[36m_run_subprocess[0m:[36m173[0m - [33m[1må­è¿›ç¨‹ stderr:
[32m2025-10-09 23:14:11.111[0m | [32m[1mSUCCESS [0m | [36m__main__[0m:[36msuccess[0m:[36m27[0m - [32m[1mæ‰§è¡Œå®Œæˆ[0m
[0m
[32m2025-10-09 23:14:11.158[0m | [1mINFO    [0m | [36mrunner.workflow_runner[0m:[36mexecute_workflow[0m:[36m139[0m - [1mæ‰§è¡ŒèŠ‚ç‚¹: æç¤ºè¯æ¨¡æ¿ 3[0m
[32m2025-10-09 23:14:11.774[0m | [33m[1mWARNING [0m | [36mrunner.component_executor[0m:[36m_run_subprocess[0m:[36m173[0m - [33m[1må­è¿›ç¨‹ stderr:
[32m2025-10-09 23:14:11.729[0m | [1mINFO    [0m | [36m__main__[0m:[36minfo[0m:[36m26[0m - [1m{'variables': {'text': 'æˆ‘çš„éœ€æ±‚æ˜¯å¼€å‘ä¸€ä¸ªé€»è¾‘å›å½’ç»„ä»¶'}}[0m
[32m2025-10-09 23:14:11.729[0m | [1mINFO    [0m | [36m__main__[0m:[36minfo[0m:[36m26[0m - [1m##  ä»»åŠ¡
æ ¹æ®æˆ‘çš„ç»„ä»¶è¾“å…¥ã€è¾“å‡ºã€èŠ‚ç‚¹å‚æ•°å®šä¹‰ä»¥åŠæˆ‘çš„æ ·ä¾‹ä»£ç ã€éœ€æ±‚ç­‰ä¿¡æ¯è‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„pythonç»„ä»¶ä»£ç 

## ç»„ä»¶è¾“å…¥è¾“å‡ºå‚æ•°å®šä¹‰ä»£ç 
class ArgumentType(str, Enum):
    """å‚æ•°ç±»å‹"""
    TEXT = "æ–‡æœ¬"
    INT = "æ•´æ•°"
    FLOAT = "æµ®ç‚¹æ•°"
    BOOL = "å¸ƒå°”å€¼"
    ARRAY = "åˆ—è¡¨"
    CSV = "csv"
    JSON = "json"
    EXCEL = "excel"
    FILE = "æ–‡ä»¶"
    UPLOAD = "ä¸Šä¼ "
    SKLEARNMODEL = "sklearnæ¨¡å‹"
    TORCHMODEL = "torchæ¨¡å‹"
    IMAGE = "å›¾ç‰‡"

class PortDefinition(BaseModel):
    """ç«¯å£å®šä¹‰"""
    name: str
    label: str
    type: ArgumentType = ArgumentType.TEXT

## ç»„ä»¶å±æ€§å‚æ•°å®šä¹‰ä»£ç 
class PropertyType(str, Enum):
    """å±æ€§ç±»å‹"""
    TEXT = "æ–‡æœ¬"
    LONGTEXT = "é•¿æ–‡æœ¬"
    INT = "æ•´æ•°"
    FLOAT = "æµ®ç‚¹æ•°"
    RANGE = "èŒƒå›´"
    BOOL = "å¤é€‰æ¡†"
    CHOICE = "ä¸‹æ‹‰æ¡†"
    DYNAMICFORM = "åŠ¨æ€è¡¨å•"


class PropertyDefinition(BaseModel):
    """å±æ€§å®šä¹‰"""
    type: PropertyType = PropertyType.TEXT
    default: Any = ""
    label: str = ""
    choices: List[str] = Field(default_factory=list)
    filter: str = "All Files (*)"  # ç”¨äºæ–‡ä»¶ç±»å‹è¿‡æ»¤
    schema: Optional[Dict[str, 'PropertyDefinition']] = Field(default=None)  # è¡¨å•å†…æ¯ä¸ªå­—æ®µçš„å®šä¹‰
    min: float = Field(default=0.0, description="æœ€å°å€¼")
    max: float = Field(default=100.0, description="æœ€å¤§å€¼")
    step: float = Field(default=1.0, description="æ­¥é•¿")

    class Config:
        # å…è®¸é€’å½’å¼•ç”¨
        arbitrary_types_allowed = True

## æˆ‘çš„ç»„ä»¶æ ·ä¾‹ä»£ç 
class Component(BaseComponent):
    name = "æç¤ºè¯æ¨¡æ¿"
    category = "å¤§æ¨¡å‹ç»„ä»¶"
    description = ""
    requirements = ""

    inputs = [
        PortDefinition(name="variables", label="å˜é‡å­—å…¸", type=ArgumentType.JSON),
    ]
    outputs = [
        PortDefinition(name="prompt", label="ç”Ÿæˆçš„æç¤ºè¯", type=ArgumentType.TEXT),
    ]

    properties = {
        "template": PropertyDefinition(
            type=PropertyType.LONGTEXT,
            default="""ä½ å¥½ï¼Œ{{name}}ï¼ä»Šå¤©æ˜¯{{day}}ã€‚""",
            label="æç¤ºè¯æ¨¡æ¿",
        ),
    }

    def run(self, params, inputs = None):
        import re
        self.logger.info(inputs)
        template = params.get("template", "")
        variables = inputs.get("variables", {}) if inputs else {}

        if isinstance(variables, str):
            import json
            try:
                variables = json.loads(variables)
            except:
                variables = {}

        # æ›¿æ¢ {{key}} ä¸ºå˜é‡å€¼
        def replace_match(match):
            key = match.group(1)
            return str(variables.get(key, match.group(0)))

        prompt = re.sub(r"\{\{(\w+)\}\}", replace_match, template)
        self.logger.info(prompt)
        
        return {"prompt": prompt}

## æˆ‘çš„ç»„ä»¶å¼€å‘éœ€æ±‚
æˆ‘çš„éœ€æ±‚æ˜¯å¼€å‘ä¸€ä¸ªé€»è¾‘å›å½’ç»„ä»¶

## ä»£ç è¾“å‡ºè¦æ±‚
è¾“å‡ºä»£ç ä¸éœ€è¦åŒ…å«è¾“å…¥ã€è¾“å‡ºä»¥åŠå±æ€§å‚æ•°å®šä¹‰ä»£ç ï¼Œè¿™éƒ¨åˆ†å·²ç»å†™å¥½äº†ï¼ŒåŒæ—¶ç¬¬ä¸‰æ–¹å·¥å…·åŒ…å¯¼å…¥æ—¶åªèƒ½åœ¨å‡½æ•°å†…å¯¼å…¥ï¼Œä¸èƒ½åœ¨æ–‡ä»¶å¼€å¤´å¯¼å…¥ï¼Œä¸è¦å¼•å…¥Dictï¼ŒListè¿™äº›å‚æ•°æ ¼å¼å®šä¹‰ã€‚

## ç”Ÿæˆçš„ç»„ä»¶ä»£ç 
[0m
[32m2025-10-09 23:14:11.729[0m | [32m[1mSUCCESS [0m | [36m__main__[0m:[36msuccess[0m:[36m27[0m - [32m[1mæ‰§è¡Œå®Œæˆ[0m
[0m
[32m2025-10-09 23:14:11.775[0m | [1mINFO    [0m | [36mrunner.workflow_runner[0m:[36mexecute_workflow[0m:[36m139[0m - [1mæ‰§è¡ŒèŠ‚ç‚¹: å¤§æ¨¡å‹å¯¹è¯[0m
[32m2025-10-09 23:14:14.209[0m | [33m[1mWARNING [0m | [36mrunner.component_executor[0m:[36m_run_subprocess[0m:[36m173[0m - [33m[1må­è¿›ç¨‹ stderr:
[32m2025-10-09 23:14:12.766[0m | [1mINFO    [0m | [36m__main__[0m:[36minfo[0m:[36m26[0m - [1mqwen/qwen3-30b-a3b[0m
[32m2025-10-09 23:14:12.766[0m | [1mINFO    [0m | [36m__main__[0m:[36minfo[0m:[36m26[0m - [1mä½ æ˜¯ä¸€ä¸ªä»£ç ç¼–è¾‘ä¸“å®¶ï¼Œèƒ½å¤Ÿæ ¹æ®ç”¨æˆ·çš„éœ€æ±‚ç”Ÿæˆä¸“ä¸šçš„pythonä»£ç ã€‚[0m
[32m2025-10-09 23:14:14.115[0m | [1mINFO    [0m | [36m__main__[0m:[36minfo[0m:[36m26[0m - [1mChatCompletion(id='chatcmpl-zrmg6zv8vjjuv1ab56tdlr', choices=[Choice(finish_reason='length', index=0, logprobs=None, message=ChatCompletionMessage(content='<think>\nå¥½çš„ï¼Œæˆ‘ç°åœ¨éœ€è¦å¸®ç”¨æˆ·ç”Ÿæˆä¸€ä¸ªé€»è¾‘å›å½’ç»„ä»¶çš„Pythonä»£ç ã€‚é¦–å…ˆï¼Œæˆ‘å¾—ä»”ç»†çœ‹çœ‹ç”¨æˆ·æä¾›çš„ä¿¡æ¯å’Œè¦æ±‚ã€‚ç”¨æˆ·å·²ç»ç»™äº†ç»„ä»¶è¾“å…¥è¾“å‡ºå‚æ•°å®šä¹‰ã€å±æ€§å‚æ•°å®šä¹‰çš„ä»£ç ï¼Œè¿˜æœ‰ä»–ä»¬è‡ªå·±çš„æ ·ä¾‹ä»£ç ï¼Œä»¥åŠéœ€æ±‚æ˜¯å¼€å‘ä¸€ä¸ªé€»è¾‘å›å½’ç»„ä»¶ã€‚\n\né¦–å…ˆï¼Œç”¨æˆ·çš„è¦æ±‚æ˜¯ä¸è¦åŒ…å«è¾“å…¥è¾“å‡ºå’Œå±æ€§å‚æ•°å®šä¹‰çš„ä»£ç ï¼Œæ‰€ä»¥æˆ‘è¦ç¡®ä¿ç”Ÿæˆçš„ä»£ç é‡Œä¸åŒ…æ‹¬é‚£äº›ç±»å®šä¹‰ã€‚åŒæ—¶ï¼Œç¬¬ä¸‰æ–¹å·¥å…·åŒ…åªèƒ½åœ¨å‡½æ•°å†…éƒ¨å¯¼å…¥', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=[]))], created=1760022853, model='qwen/qwen3-30b-a3b', object='chat.completion', service_tier=None, system_fingerprint='qwen/qwen3-30b-a3b', usage=CompletionUsage(completion_tokens=100, prompt_tokens=806, total_tokens=906, completion_tokens_details=None, prompt_tokens_details=None), stats={})[0m
[32m2025-10-09 23:14:14.115[0m | [32m[1mSUCCESS [0m | [36m__main__[0m:[36msuccess[0m:[36m27[0m - [32m[1mæ‰§è¡Œå®Œæˆ[0m
[0m
[32m2025-10-09 23:14:14.216[0m | [1mINFO    [0m | [36m__main__[0m:[36mrun_workflow[0m:[36m117[0m - [1må·¥ä½œæµæ‰§è¡ŒæˆåŠŸï¼Œç»“æœï¼š{'response': '<think>\nå¥½çš„ï¼Œæˆ‘ç°åœ¨éœ€è¦å¸®ç”¨æˆ·ç”Ÿæˆä¸€ä¸ªé€»è¾‘å›å½’ç»„ä»¶çš„Pythonä»£ç ã€‚é¦–å…ˆï¼Œæˆ‘å¾—ä»”ç»†çœ‹çœ‹ç”¨æˆ·æä¾›çš„ä¿¡æ¯å’Œè¦æ±‚ã€‚ç”¨æˆ·å·²ç»ç»™äº†ç»„ä»¶è¾“å…¥è¾“å‡ºå‚æ•°å®šä¹‰ã€å±æ€§å‚æ•°å®šä¹‰çš„ä»£ç ï¼Œè¿˜æœ‰ä»–ä»¬è‡ªå·±çš„æ ·ä¾‹ä»£ç ï¼Œä»¥åŠéœ€æ±‚æ˜¯å¼€å‘ä¸€ä¸ªé€»è¾‘å›å½’ç»„ä»¶ã€‚\n\né¦–å…ˆï¼Œç”¨æˆ·çš„è¦æ±‚æ˜¯ä¸è¦åŒ…å«è¾“å…¥è¾“å‡ºå’Œå±æ€§å‚æ•°å®šä¹‰çš„ä»£ç ï¼Œæ‰€ä»¥æˆ‘è¦ç¡®ä¿ç”Ÿæˆçš„ä»£ç é‡Œä¸åŒ…æ‹¬é‚£äº›ç±»å®šä¹‰ã€‚åŒæ—¶ï¼Œç¬¬ä¸‰æ–¹å·¥å…·åŒ…åªèƒ½åœ¨å‡½æ•°å†…éƒ¨å¯¼å…¥'}[0m
INFO:     127.0.0.1:56111 - "POST /run HTTP/1.1" 200 OK
