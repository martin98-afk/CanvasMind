
[32m2025-10-09 23:11:24.173[0m | [1mINFO    [0m | [36mrunner.workflow_runner[0m:[36mexecute_workflow[0m:[36m139[0m - [1mæ‰§è¡ŒèŠ‚ç‚¹: é•¿æ–‡æœ¬è¾“å…¥ 1[0m
[32m2025-10-09 23:11:24.785[0m | [33m[1mWARNING [0m | [36mrunner.component_executor[0m:[36m_run_subprocess[0m:[36m173[0m - [33m[1må­è¿›ç¨‹ stderr:
[32m2025-10-09 23:11:24.743[0m | [32m[1mSUCCESS [0m | [36m__main__[0m:[36msuccess[0m:[36m27[0m - [32m[1mæ‰§è¡Œå®Œæˆ[0m
[0m
[32m2025-10-09 23:11:24.791[0m | [1mINFO    [0m | [36mrunner.workflow_runner[0m:[36mexecute_workflow[0m:[36m139[0m - [1mæ‰§è¡ŒèŠ‚ç‚¹: JSONæ–‡æœ¬åŒ…è£…[0m
[32m2025-10-09 23:11:25.394[0m | [33m[1mWARNING [0m | [36mrunner.component_executor[0m:[36m_run_subprocess[0m:[36m173[0m - [33m[1må­è¿›ç¨‹ stderr:
[32m2025-10-09 23:11:25.350[0m | [32m[1mSUCCESS [0m | [36m__main__[0m:[36msuccess[0m:[36m27[0m - [32m[1mæ‰§è¡Œå®Œæˆ[0m
[0m
[32m2025-10-09 23:11:25.395[0m | [1mINFO    [0m | [36mrunner.workflow_runner[0m:[36mexecute_workflow[0m:[36m139[0m - [1mæ‰§è¡ŒèŠ‚ç‚¹: æç¤ºè¯æ¨¡æ¿ 3[0m
[32m2025-10-09 23:11:25.986[0m | [33m[1mWARNING [0m | [36mrunner.component_executor[0m:[36m_run_subprocess[0m:[36m173[0m - [33m[1må­è¿›ç¨‹ stderr:
[32m2025-10-09 23:11:25.942[0m | [1mINFO    [0m | [36m__main__[0m:[36minfo[0m:[36m26[0m - [1m{'variables': {'text': 'æˆ‘çš„éœ€æ±‚æ˜¯å¼€å‘ä¸€ä¸ªå¤§æ¨¡å‹å¯¹è¯ç»„ä»¶'}}[0m
[32m2025-10-09 23:11:25.942[0m | [1mINFO    [0m | [36m__main__[0m:[36minfo[0m:[36m26[0m - [1m##  ä»»åŠ¡
æ ¹æ®æˆ‘çš„ç»„ä»¶è¾“å…¥ã€è¾“å‡ºã€èŠ‚ç‚¹å‚æ•°å®šä¹‰ä»¥åŠæˆ‘çš„æ ·ä¾‹ä»£ç ã€éœ€æ±‚ç­‰ä¿¡æ¯è‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„pythonç»„ä»¶ä»£ç 

## ç»„ä»¶è¾“å…¥è¾“å‡ºå‚æ•°å®šä¹‰ä»£ç 
class ArgumentType(str, Enum):
    """å‚æ•°ç±»å‹"""
    TEXT = "æ–‡æœ¬"
    INT = "æ•´æ•°"
    FLOAT = "æµ®ç‚¹æ•°"
    BOOL = "å¸ƒå°”å€¼"
    ARRAY = "åˆ—è¡¨"
    CSV = "csv"
    JSON = "json"
    EXCEL = "excel"
    FILE = "æ–‡ä»¶"
    UPLOAD = "ä¸Šä¼ "
    SKLEARNMODEL = "sklearnæ¨¡å‹"
    TORCHMODEL = "torchæ¨¡å‹"
    IMAGE = "å›¾ç‰‡"

class PortDefinition(BaseModel):
    """ç«¯å£å®šä¹‰"""
    name: str
    label: str
    type: ArgumentType = ArgumentType.TEXT

## ç»„ä»¶å±æ€§å‚æ•°å®šä¹‰ä»£ç 
class PropertyType(str, Enum):
    """å±æ€§ç±»å‹"""
    TEXT = "æ–‡æœ¬"
    LONGTEXT = "é•¿æ–‡æœ¬"
    INT = "æ•´æ•°"
    FLOAT = "æµ®ç‚¹æ•°"
    RANGE = "èŒƒå›´"
    BOOL = "å¤é€‰æ¡†"
    CHOICE = "ä¸‹æ‹‰æ¡†"
    DYNAMICFORM = "åŠ¨æ€è¡¨å•"


class PropertyDefinition(BaseModel):
    """å±æ€§å®šä¹‰"""
    type: PropertyType = PropertyType.TEXT
    default: Any = ""
    label: str = ""
    choices: List[str] = Field(default_factory=list)
    filter: str = "All Files (*)"  # ç”¨äºæ–‡ä»¶ç±»å‹è¿‡æ»¤
    schema: Optional[Dict[str, 'PropertyDefinition']] = Field(default=None)  # è¡¨å•å†…æ¯ä¸ªå­—æ®µçš„å®šä¹‰
    min: float = Field(default=0.0, description="æœ€å°å€¼")
    max: float = Field(default=100.0, description="æœ€å¤§å€¼")
    step: float = Field(default=1.0, description="æ­¥é•¿")

    class Config:
        # å…è®¸é€’å½’å¼•ç”¨
        arbitrary_types_allowed = True

## æˆ‘çš„ç»„ä»¶æ ·ä¾‹ä»£ç 
class Component(BaseComponent):
    name = "æç¤ºè¯æ¨¡æ¿"
    category = "å¤§æ¨¡å‹ç»„ä»¶"
    description = ""
    requirements = ""

    inputs = [
        PortDefinition(name="variables", label="å˜é‡å­—å…¸", type=ArgumentType.JSON),
    ]
    outputs = [
        PortDefinition(name="prompt", label="ç”Ÿæˆçš„æç¤ºè¯", type=ArgumentType.TEXT),
    ]

    properties = {
        "template": PropertyDefinition(
            type=PropertyType.LONGTEXT,
            default="""ä½ å¥½ï¼Œ{{name}}ï¼ä»Šå¤©æ˜¯{{day}}ã€‚""",
            label="æç¤ºè¯æ¨¡æ¿",
        ),
    }

    def run(self, params, inputs = None):
        import re
        self.logger.info(inputs)
        template = params.get("template", "")
        variables = inputs.get("variables", {}) if inputs else {}

        if isinstance(variables, str):
            import json
            try:
                variables = json.loads(variables)
            except:
                variables = {}

        # æ›¿æ¢ {{key}} ä¸ºå˜é‡å€¼
        def replace_match(match):
            key = match.group(1)
            return str(variables.get(key, match.group(0)))

        prompt = re.sub(r"\{\{(\w+)\}\}", replace_match, template)
        self.logger.info(prompt)
        
        return {"prompt": prompt}

## æˆ‘çš„ç»„ä»¶å¼€å‘éœ€æ±‚
æˆ‘çš„éœ€æ±‚æ˜¯å¼€å‘ä¸€ä¸ªå¤§æ¨¡å‹å¯¹è¯ç»„ä»¶

## ä»£ç è¾“å‡ºè¦æ±‚
è¾“å‡ºä»£ç ä¸éœ€è¦åŒ…å«è¾“å…¥ã€è¾“å‡ºä»¥åŠå±æ€§å‚æ•°å®šä¹‰ä»£ç ï¼Œè¿™éƒ¨åˆ†å·²ç»å†™å¥½äº†ï¼ŒåŒæ—¶ç¬¬ä¸‰æ–¹å·¥å…·åŒ…å¯¼å…¥æ—¶åªèƒ½åœ¨å‡½æ•°å†…å¯¼å…¥ï¼Œä¸èƒ½åœ¨æ–‡ä»¶å¼€å¤´å¯¼å…¥ï¼Œä¸è¦å¼•å…¥Dictï¼ŒListè¿™äº›å‚æ•°æ ¼å¼å®šä¹‰ã€‚

## ç”Ÿæˆçš„ç»„ä»¶ä»£ç 
[0m
[32m2025-10-09 23:11:25.942[0m | [32m[1mSUCCESS [0m | [36m__main__[0m:[36msuccess[0m:[36m27[0m - [32m[1mæ‰§è¡Œå®Œæˆ[0m
[0m
[32m2025-10-09 23:11:25.993[0m | [1mINFO    [0m | [36mrunner.workflow_runner[0m:[36mexecute_workflow[0m:[36m139[0m - [1mæ‰§è¡ŒèŠ‚ç‚¹: å¤§æ¨¡å‹å¯¹è¯[0m
[32m2025-10-09 23:11:26.614[0m | [34m[1mDEBUG   [0m | [36mrunner.component_executor[0m:[36m_run_subprocess[0m:[36m171[0m - [34m[1må­è¿›ç¨‹ stdout:
EXECUTION_ERROR: ç»„ä»¶æ‰§è¡Œå¤±è´¥: Traceback (most recent call last):
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 264, in read_input_data
    return self._read_json_data(input_value)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 309, in _read_json_data
    raise ComponentError(f"æ— æ³•è¯»å–JSONæ•°æ®: {type(data)}")
base.ComponentError: æ— æ³•è¯»å–JSONæ•°æ®: <class 'NoneType'>

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 487, in execute
    validated_inputs[port.name] = self.read_input_data(
                                  ^^^^^^^^^^^^^^^^^^^^^
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 278, in read_input_data
    raise ComponentError(f"è¯»å–è¾“å…¥ {input_name} å¤±è´¥: {str(e)}", "INPUT_READ_ERROR")
base.ComponentError: è¯»å–è¾“å…¥ history å¤±è´¥: æ— æ³•è¯»å–JSONæ•°æ®: <class 'NoneType'>

[0m
[32m2025-10-09 23:11:26.622[0m | [31m[1mERROR   [0m | [36mrunner.workflow_runner[0m:[36mexecute_workflow[0m:[36m149[0m - [31m[1mèŠ‚ç‚¹æ‰§è¡Œå¤±è´¥ å¤§æ¨¡å‹å¯¹è¯: ç»„ä»¶æ‰§è¡Œå¤±è´¥: ç»„ä»¶æ‰§è¡Œå¤±è´¥: Traceback (most recent call last):
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 264, in read_input_data
    return self._read_json_data(input_value)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 309, in _read_json_data
    raise ComponentError(f"æ— æ³•è¯»å–JSONæ•°æ®: {type(data)}")
base.ComponentError: æ— æ³•è¯»å–JSONæ•°æ®: <class 'NoneType'>

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 487, in execute
    validated_inputs[port.name] = self.read_input_data(
                                  ^^^^^^^^^^^^^^^^^^^^^
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 278, in read_input_data
    raise ComponentError(f"è¯»å–è¾“å…¥ {input_name} å¤±è´¥: {str(e)}", "INPUT_READ_ERROR")
base.ComponentError: è¯»å–è¾“å…¥ history å¤±è´¥: æ— æ³•è¯»å–JSONæ•°æ®: <class 'NoneType'>

Traceback (most recent call last):
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 264, in read_input_data
    return self._read_json_data(input_value)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 309, in _read_json_data
    raise ComponentError(f"æ— æ³•è¯»å–JSONæ•°æ®: {type(data)}")
base.ComponentError: æ— æ³•è¯»å–JSONæ•°æ®: <class 'NoneType'>

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 487, in execute
    validated_inputs[port.name] = self.read_input_data(
                                  ^^^^^^^^^^^^^^^^^^^^^
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 278, in read_input_data
    raise ComponentError(f"è¯»å–è¾“å…¥ {input_name} å¤±è´¥: {str(e)}", "INPUT_READ_ERROR")
base.ComponentError: è¯»å–è¾“å…¥ history å¤±è´¥: æ— æ³•è¯»å–JSONæ•°æ®: <class 'NoneType'>

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\black\AppData\Local\Temp\tmpj3bskwnz.py", line 43, in <module>
    output = comp_instance.execute(params, inputs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 519, in execute
    raise ComponentError(error_msg, "EXECUTION_ERROR")
base.ComponentError: ç»„ä»¶æ‰§è¡Œå¤±è´¥: Traceback (most recent call last):
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 264, in read_input_data
    return self._read_json_data(input_value)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 309, in _read_json_data
    raise ComponentError(f"æ— æ³•è¯»å–JSONæ•°æ®: {type(data)}")
base.ComponentError: æ— æ³•è¯»å–JSONæ•°æ®: <class 'NoneType'>

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 487, in execute
    validated_inputs[port.name] = self.read_input_data(
                                  ^^^^^^^^^^^^^^^^^^^^^
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 278, in read_input_data
    raise ComponentError(f"è¯»å–è¾“å…¥ {input_name} å¤±è´¥: {str(e)}", "INPUT_READ_ERROR")
base.ComponentError: è¯»å–è¾“å…¥ history å¤±è´¥: æ— æ³•è¯»å–JSONæ•°æ®: <class 'NoneType'>

[0m
[32m2025-10-09 23:11:26.623[0m | [31m[1mERROR   [0m | [36mrunner.workflow_runner[0m:[36mexecute_workflow[0m:[36m151[0m - [31m[1mTraceback (most recent call last):
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\runner\workflow_runner.py", line 140, in execute_workflow
    output = run_component_in_subprocess(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\runner\component_executor.py", line 82, in run_component_in_subprocess
    raise RuntimeError(f"ç»„ä»¶æ‰§è¡Œå¤±è´¥: {error_info['error']}\n{error_info['traceback']}")
RuntimeError: ç»„ä»¶æ‰§è¡Œå¤±è´¥: ç»„ä»¶æ‰§è¡Œå¤±è´¥: Traceback (most recent call last):
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 264, in read_input_data
    return self._read_json_data(input_value)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 309, in _read_json_data
    raise ComponentError(f"æ— æ³•è¯»å–JSONæ•°æ®: {type(data)}")
base.ComponentError: æ— æ³•è¯»å–JSONæ•°æ®: <class 'NoneType'>

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 487, in execute
    validated_inputs[port.name] = self.read_input_data(
                                  ^^^^^^^^^^^^^^^^^^^^^
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 278, in read_input_data
    raise ComponentError(f"è¯»å–è¾“å…¥ {input_name} å¤±è´¥: {str(e)}", "INPUT_READ_ERROR")
base.ComponentError: è¯»å–è¾“å…¥ history å¤±è´¥: æ— æ³•è¯»å–JSONæ•°æ®: <class 'NoneType'>

Traceback (most recent call last):
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 264, in read_input_data
    return self._read_json_data(input_value)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 309, in _read_json_data
    raise ComponentError(f"æ— æ³•è¯»å–JSONæ•°æ®: {type(data)}")
base.ComponentError: æ— æ³•è¯»å–JSONæ•°æ®: <class 'NoneType'>

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 487, in execute
    validated_inputs[port.name] = self.read_input_data(
                                  ^^^^^^^^^^^^^^^^^^^^^
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 278, in read_input_data
    raise ComponentError(f"è¯»å–è¾“å…¥ {input_name} å¤±è´¥: {str(e)}", "INPUT_READ_ERROR")
base.ComponentError: è¯»å–è¾“å…¥ history å¤±è´¥: æ— æ³•è¯»å–JSONæ•°æ®: <class 'NoneType'>

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\black\AppData\Local\Temp\tmpj3bskwnz.py", line 43, in <module>
    output = comp_instance.execute(params, inputs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 519, in execute
    raise ComponentError(error_msg, "EXECUTION_ERROR")
base.ComponentError: ç»„ä»¶æ‰§è¡Œå¤±è´¥: Traceback (most recent call last):
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 264, in read_input_data
    return self._read_json_data(input_value)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 309, in _read_json_data
    raise ComponentError(f"æ— æ³•è¯»å–JSONæ•°æ®: {type(data)}")
base.ComponentError: æ— æ³•è¯»å–JSONæ•°æ®: <class 'NoneType'>

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 487, in execute
    validated_inputs[port.name] = self.read_input_data(
                                  ^^^^^^^^^^^^^^^^^^^^^
  File "D:\work\WorkFlowGUI\projects\å¤§æ¨¡å‹æµç¨‹\components\base.py", line 278, in read_input_data
    raise ComponentError(f"è¯»å–è¾“å…¥ {input_name} å¤±è´¥: {str(e)}", "INPUT_READ_ERROR")
base.ComponentError: è¯»å–è¾“å…¥ history å¤±è´¥: æ— æ³•è¯»å–JSONæ•°æ®: <class 'NoneType'>


[0m
[32m2025-10-09 23:11:26.623[0m | [1mINFO    [0m | [36m__main__[0m:[36m<module>[0m:[36m15[0m - [1mæ¨¡å‹æ‰§è¡Œå®Œæˆï¼Œè¾“å‡º:[0m
[32m2025-10-09 23:11:26.623[0m | [1mINFO    [0m | [36m__main__[0m:[36m<module>[0m:[36m17[0m - [1m  response: None[0m
